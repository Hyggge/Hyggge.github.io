<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="「BUAA-CO」P6_流水线cpu（Plus）, Hyggge&#39;s Blog">
    <meta name="description" content="流水线CPU设计方案
设计概述
​
本文所设计的CPU为Verilog实现的流水线MIPS架构CPU，该CPU支持43条MIPS汇编指令，为了实现该功能，笔者设计了IFU，GRF，NPC，CMP，EXT，ALU，D_Reg，E_Reg，M_">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>「BUAA-CO」P6_流水线cpu（Plus） | Hyggge&#39;s Blog</title>
    <link rel="icon" type="image/jpeg" href="/medias/avatar.jpg">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Hyggge's Blog" type="application/atom+xml">
</head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.svg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Hyggge&#39;s Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Home</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>Tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Archives</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>About</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.svg" class="logo-img circle responsive-img">
        
        <div class="logo-name">Hyggge&#39;s Blog</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Home
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Archives
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			About
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/hyggge" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Come On
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/hyggge" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Come On" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/9.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">「BUAA-CO」P6_流水线cpu（Plus）</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/BUAA/">
                                <span class="chip bg-color">BUAA</span>
                            </a>
                        
                            <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90/">
                                <span class="chip bg-color">计算机组成</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90/" class="post-category">
                                计算机组成
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-11-26
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    11.7k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    53 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.min.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="流水线cpu设计方案">流水线CPU设计方案</h2>
<h3 id="设计概述">设计概述</h3>
<p>​
本文所设计的CPU为Verilog实现的流水线MIPS架构CPU，该CPU支持43条MIPS汇编指令，为了实现该功能，笔者设计了IFU，GRF，NPC，CMP，EXT，ALU，D_Reg，E_Reg，M_Reg，W_Reg，MCU，
HCU，MDU，BE，DE
等关键模块。整个搭建过程通过自下而上的方式完成——先根据应实现的指令对功能部件进行设计与搭建，然后对各个功能部件进行连接，形成完整的数据通路。</p>
<h3 id="实现指令说明">实现指令说明</h3>
<p>我们将本CPU实现的指令分为以下几类：</p>
<ul>
<li><p><strong>calc_R</strong>: add,sub,addu, subu, and, or, nor, xor,
slt, sltu</p></li>
<li><p><strong>calc_I</strong>: addi,addiu, andi, ori, xori, slti,
sltiu</p></li>
<li><p><strong>shift</strong>: sll, sra, srl</p></li>
<li><p><strong>shiftv</strong>: sllv, srav, srlv</p></li>
<li><p><strong>load</strong>: lw, lh, lhu, lb, lbu</p></li>
<li><p><strong>store</strong>: sw, sh, sb</p></li>
<li><p><strong>B类</strong>：beq,bne,bgtz,blez,bgez,bltz</p></li>
<li><p><strong>J类</strong>：j, jal, jr, jalr</p></li>
<li><p><strong>特殊</strong>：lui</p></li>
<li><p><strong>md类</strong>：mult, multu, div, divu</p></li>
<li><p><strong>mf类</strong>：mfhi, mflo</p></li>
<li><p><strong>mt类</strong>：mthi, mtlo</p></li>
</ul>
<h2 id="工程模块定义">工程模块定义</h2>
<p>在P6实验中，我们将IM（<strong>16KB</strong>(32bit/word×<strong>4096word</strong>)）和DM（<strong>16KB</strong>(32bit/word×<strong>4096word</strong>)）外置，因此在P5的基础上，我们在cpu中删去了这两个部分，同时增加相应的信号与接口与外置的IM和DM进行信息交换。同时，为了评测GRF的读写行为，我们还需要将GRF的读写信息通过相应接口和信号传入外部（test
bench）。相关接口如下（在顶层模块mips中定义）</p>
<table>
<colgroup>
<col style="width: 20%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 66%">
</colgroup>
<thead>
<tr class="header">
<th>信号名</th>
<th>方向</th>
<th>位宽</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>clk</td>
<td>I</td>
<td>1</td>
<td>时钟信号</td>
</tr>
<tr class="even">
<td>reset</td>
<td>I</td>
<td>1</td>
<td>同步复位信号</td>
</tr>
<tr class="odd">
<td>i_inst_rdata</td>
<td>I</td>
<td>32</td>
<td>i_inst_addr队形的32位指令</td>
</tr>
<tr class="even">
<td>m_data_addr</td>
<td>I</td>
<td>32</td>
<td>m_data_addr 对应的 32 位数据</td>
</tr>
<tr class="odd">
<td>i_inst_addr</td>
<td>O</td>
<td>32</td>
<td>需要进行取指操作的流水级 PC（一般为 F 级）</td>
</tr>
<tr class="even">
<td>m_data_addr</td>
<td>O</td>
<td>32</td>
<td>数据存储器待写入地址</td>
</tr>
<tr class="odd">
<td>m_data_wdata</td>
<td>O</td>
<td>32</td>
<td>数据存储器待写入数据</td>
</tr>
<tr class="even">
<td>m_data_byteen</td>
<td>O</td>
<td>4</td>
<td>字节使能信号（相当于之前的MenWrite信号）</td>
</tr>
<tr class="odd">
<td>m_inst_addr</td>
<td>O</td>
<td>32</td>
<td>M级PC</td>
</tr>
<tr class="even">
<td>w_grf_we</td>
<td>O</td>
<td>1</td>
<td>grf 写使能信号</td>
</tr>
<tr class="odd">
<td>w_grf_addr</td>
<td>O</td>
<td>5</td>
<td>grf 中待写入寄存器编号</td>
</tr>
<tr class="even">
<td>w_grf_wdata</td>
<td>O</td>
<td>32</td>
<td>grf 中待写入数据</td>
</tr>
<tr class="odd">
<td>w_inst_addr</td>
<td>O</td>
<td>32</td>
<td>W 级 PC</td>
</tr>
</tbody>
</table>
<h3 id="功能模块定义">功能模块定义</h3>
<h4 id="ifu取指令单元">IFU（取指令单元）</h4>
<p>该模块相当于程序计数器，在时钟上升沿时将npc写入pc，并具有同步复位的功能。同时，为了配合jal，jalr的链接操作，我们同时输出pc+8的值，在后面的流水寄存器中传递。</p>
<ul>
<li><p><strong>端口定义</strong><br>
| 信号名 | 方向 | 位宽 | 描述 |<br>
| :----: | :--: | :--: | :--------------------------- |<br>
| clk | I | 1 | 时钟信号 |<br>
| reset | I | 1 | 异步复位信号 |<br>
| en | I | 1 | 使能信号 |<br>
| npc | I | 32 | 下一条要被执行的指令的地址 |<br>
| pc | O | 32 | 输出当前正在执行的指令的地址 |<br>
| pc8 | O | 32 | pc+8 |</p></li>
<li><p><strong>功能定义</strong><br>
| 序号 | 功能名称 | 功能描述 |<br>
| ---- | ---------- |
------------------------------------------------------------ |<br>
| 1 | 复位 | 当reset信号有效时，将PC寄存器中的值置为0x00003000 |<br>
| 2 | 停止 | 当en信号失效时，PC寄存器忽略时钟输入，PC当前值保持不变
|<br>
| 3 | 写PC寄存器 |
当en信号失效且时钟上升沿来临时，将下一条指令的地址（next
PC）写入PC寄存器 |</p></li>
</ul>
<h4 id="grf通用寄存器组">GRF（通用寄存器组）</h4>
<p>该模块内部包含32个具有写使能32位寄存器，分别对应MIPS架构中$0 ~
$31通用寄存器（其中0号寄存器中的值恒为0，即不具备写使能，因此为了实现该机制，我们不再设置0号寄存器，每次对0进行特判）。GRF可以实现同步复位，同时可以根据输入的5位地址（0~31）向寄存器堆存取数据，实现定向访存寄存器。</p>
<p>为了实现内部转发，在GRF写入地址与读取地址相同时，我们将当前WD中输入的数据（但没有写入）实时反映到RD1或RD2端口上，用来解决数据冲突。</p>
<ul>
<li><p><strong>端口定义</strong></p>
<table>
<colgroup>
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 80%">
</colgroup>
<thead>
<tr class="header">
<th>信号名</th>
<th>方向</th>
<th>位宽</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>clk</td>
<td>I</td>
<td>1</td>
<td>时钟信号</td>
</tr>
<tr class="even">
<td>pc</td>
<td>I</td>
<td>32</td>
<td>输出当前正在执行的</td>
</tr>
<tr class="odd">
<td>reset</td>
<td>I</td>
<td>1</td>
<td>同步复位信号<br>1：复位信号有效<br>0：复位信号无效</td>
</tr>
<tr class="even">
<td>A1</td>
<td>I</td>
<td>5</td>
<td>地址输入信号，指定32个寄存器中的一个，将其中的数据读出到RD1</td>
</tr>
<tr class="odd">
<td>A2</td>
<td>I</td>
<td>5</td>
<td>地址输入信号，指定32个寄存器中的一个，将其中的数据读出到RD2</td>
</tr>
<tr class="even">
<td>A3</td>
<td>I</td>
<td>5</td>
<td>地址输入信号，指定32个寄存器中的一个，将其作为写入目标</td>
</tr>
<tr class="odd">
<td>WD</td>
<td>I</td>
<td>32</td>
<td>数据输入信号</td>
</tr>
<tr class="even">
<td>WE</td>
<td>I</td>
<td>1</td>
<td>写使能信号<br>1：写入有效<br>0：写入失效</td>
</tr>
<tr class="odd">
<td>RD1</td>
<td>O</td>
<td>32</td>
<td>输出A1指定的寄存器中的32位数据</td>
</tr>
<tr class="even">
<td>RD2</td>
<td>O</td>
<td>32</td>
<td>输出A2指定的寄存器中的32位数据</td>
</tr>
</tbody>
</table></li>
<li><p><strong>功能定义</strong></p>
<table>
<colgroup>
<col style="width: 5%">
<col style="width: 11%">
<col style="width: 83%">
</colgroup>
<thead>
<tr class="header">
<th>序号</th>
<th>功能名称</th>
<th>功能描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>复位</td>
<td>reset信号有效时，所有寄存器中储存的值均被清零</td>
</tr>
<tr class="even">
<td>2</td>
<td>读数据</td>
<td>读出A1，A2地址对应的寄存器中储存的数据，将其加载到RD1和RD2</td>
</tr>
<tr class="odd">
<td>3</td>
<td>写数据</td>
<td>当WE信号有效且时钟上升沿来临时，将WD中的数据写入到A3地址对应的寄存器</td>
</tr>
</tbody>
</table></li>
</ul>
<h4 id="npc下一指令计算单元">NPC（下一指令计算单元）</h4>
<p>​
该模块根据当前pc（包括D级和F级）和其他控制信号（NPCOp，CMP输出信息），计算出下一指令所在的地址npc，传入IFU模块。</p>
<ul>
<li><p><strong>端口定义</strong></p>
<table>
<colgroup>
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 81%">
</colgroup>
<thead>
<tr class="header">
<th>信号名</th>
<th>方向</th>
<th>位宽</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>F_pc</td>
<td>I</td>
<td>32</td>
<td>F级指令地址</td>
</tr>
<tr class="even">
<td>D_pc</td>
<td>I</td>
<td>32</td>
<td>D级指令地址</td>
</tr>
<tr class="odd">
<td>offset</td>
<td>I</td>
<td>32</td>
<td>地址偏移量，用于计算B类指令所要跳转的地址</td>
</tr>
<tr class="even">
<td>imm26</td>
<td>I</td>
<td>26</td>
<td>当前指令数据的前26位（0~25），用于计算jal和j指令所要跳转的地址</td>
</tr>
<tr class="odd">
<td>ra</td>
<td>I</td>
<td>32</td>
<td>储存在寄存器（$ra或是jalr指令中存储“PC+4”的寄存器）中的地址数据，用于实现jr和jalr指令</td>
</tr>
<tr class="even">
<td>judge</td>
<td>I</td>
<td>1</td>
<td>B类指令判断结果<br>1：说明当前B类指令的判断结果为真<br>0：说明判断结果为假</td>
</tr>
<tr class="odd">
<td>NPCOp</td>
<td>I</td>
<td>3</td>
<td>NPC功能选择<br>0x000：顺序执行<br>0x001：B类指令跳转<br>0x010:
jal/j跳转<br>0x011: jr/jalr跳转</td>
</tr>
<tr class="even">
<td>npc</td>
<td>O</td>
<td>32</td>
<td>输出下一指令地址</td>
</tr>
</tbody>
</table></li>
</ul>
<h4 id="ext扩展单元">EXT（扩展单元）</h4>
<p>​
该模块对16位立即数进行扩展，可以实现符号扩展，0扩展和加载高位（lui）操作。</p>
<ul>
<li><p><strong>端口定义</strong></p>
<table>
<colgroup>
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 81%">
</colgroup>
<thead>
<tr class="header">
<th>信号名</th>
<th>方向</th>
<th>位宽</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>in</td>
<td>I</td>
<td>16</td>
<td>16位立即数</td>
</tr>
<tr class="even">
<td>EXTOp</td>
<td>I</td>
<td>2</td>
<td>EXT功能选择信号<br>0x000: 0扩展<br>0x001: 符号扩展<br>0x010:
加载到高位（lui指令使用）</td>
</tr>
<tr class="odd">
<td>out</td>
<td>O</td>
<td>32</td>
<td>扩展结果</td>
</tr>
</tbody>
</table></li>
</ul>
<h4 id="cmpb类指令比较单元">CMP(B类指令比较单元)</h4>
<p>​
该单元根据输入的CMPOp信号对当前B指令的类型进行判断，进而对当前输入的数值进行相应比较，最后输出结果。</p>
<ul>
<li><p><strong>端口定义</strong></p>
<table>
<colgroup>
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 81%">
</colgroup>
<thead>
<tr class="header">
<th>信号名</th>
<th>方向</th>
<th>位宽</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>D1</td>
<td>I</td>
<td>32</td>
<td>输入CMP单元的第一个数据</td>
</tr>
<tr class="even">
<td>D1</td>
<td>I</td>
<td>32</td>
<td>输入CMP单元的第二个数据</td>
</tr>
<tr class="odd">
<td>CMPOp</td>
<td>I</td>
<td>3</td>
<td>CMPOp功能选择信号<br>0x000：beq判断<br>0x001：bne判断<br>0x010：blez判断<br>0x011:
bgtz判断</td>
</tr>
<tr class="even">
<td>out</td>
<td>O</td>
<td>1</td>
<td>判断结果输出<br>1: 判断结果为真<br>0：判断结果为假</td>
</tr>
</tbody>
</table></li>
</ul>
<h4 id="alu逻辑运算单元">ALU（逻辑运算单元）</h4>
<p>&nbsp;
该模块可实现加，减，按位与，按位或等11种运算，并根据ALUOP信号的值在这些功能中进行选择。除此之外，该模块还可以实现溢出判断。</p>
<ul>
<li><p><strong>端口定义</strong></p>
<table>
<thead>
<tr class="header">
<th>信号名</th>
<th>方向</th>
<th>位宽</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ALUOp</td>
<td>I</td>
<td>4</td>
<td>ALU功能选择信号</td>
</tr>
<tr class="even">
<td>src_A</td>
<td>I</td>
<td>32</td>
<td>参与ALU计算的第一个值</td>
</tr>
<tr class="odd">
<td>src_B</td>
<td>I</td>
<td>32</td>
<td>参与ALU计算的第二个值S</td>
</tr>
<tr class="even">
<td>shamt</td>
<td>I</td>
<td>5</td>
<td>移位数输入</td>
</tr>
<tr class="odd">
<td>out</td>
<td>O</td>
<td>32</td>
<td>输出ALU计算结果</td>
</tr>
</tbody>
</table></li>
<li><p><strong>功能定义</strong></p>
<table>
<colgroup>
<col style="width: 5%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 71%">
</colgroup>
<thead>
<tr class="header">
<th>序号</th>
<th>功能名称</th>
<th>ALU_Op</th>
<th>功能描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>加</td>
<td>0b0000</td>
<td>ALU_Result = Src_A + Src_B</td>
</tr>
<tr class="even">
<td>2</td>
<td>减</td>
<td>0b0001</td>
<td>ALU_Result = Src_A - Src_B</td>
</tr>
<tr class="odd">
<td>3</td>
<td>按位与</td>
<td>0b0010</td>
<td>ALU_Result = Src_A &amp; Src_B</td>
</tr>
<tr class="even">
<td>4</td>
<td>按位或</td>
<td>0b0011</td>
<td>ALU_Result = Src_A | Src_B</td>
</tr>
<tr class="odd">
<td>5</td>
<td>按位异或</td>
<td>0b0100</td>
<td>ALU_Result = Src_A ⊕ Src_B</td>
</tr>
<tr class="even">
<td>6</td>
<td>按位或非</td>
<td>0b0101</td>
<td>ALU_Result = ~(Src_A | Src_B)</td>
</tr>
<tr class="odd">
<td>7</td>
<td>逻辑左移</td>
<td>0b0110</td>
<td>ALU_Result = Src_B &lt;&lt; Shift</td>
</tr>
<tr class="even">
<td>8</td>
<td>逻辑右移</td>
<td>0b0111</td>
<td>ALU_Result = Src_B &gt;&gt; Shift</td>
</tr>
<tr class="odd">
<td>9</td>
<td>算术右移</td>
<td>0b1000</td>
<td>ALU_Result = Src_B &gt;&gt;&gt; Shift</td>
</tr>
<tr class="even">
<td>10</td>
<td>带符号比较</td>
<td>0b1001</td>
<td>ALU_Result = (Src_A &gt; Src_B) ? 1 : 0（带符号比较）</td>
</tr>
<tr class="odd">
<td>11</td>
<td>无符号比较</td>
<td>0b1010</td>
<td>ALU_Result = (Src_A &gt; Src_B) ? 1 : 0（无符号比较）</td>
</tr>
</tbody>
</table></li>
</ul>
<h4 id="mdu-乘除模块">MDU （乘除模块）</h4>
<p>​ 该模块对数据进行访存，容量为容量为
<strong>12KB</strong>(32bit/word×<strong>3072word</strong>),不仅可以实现对字的访问和存储，还可以实现对半字和字节的操作。</p>
<ul>
<li><p><strong>端口定义</strong></p>
<table>
<colgroup>
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 81%">
</colgroup>
<thead>
<tr class="header">
<th>信号名</th>
<th>方向</th>
<th>位宽</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>clk</td>
<td>I</td>
<td>1</td>
<td>时钟信号</td>
</tr>
<tr class="even">
<td>reset</td>
<td>I</td>
<td>1</td>
<td>复位信号</td>
</tr>
<tr class="odd">
<td>start</td>
<td>I</td>
<td>1</td>
<td>乘除运算启动信号</td>
</tr>
<tr class="even">
<td>MDUOp</td>
<td>I</td>
<td>4</td>
<td>乘除模块功能选择<br>0x0000：空指令<br>0x0001：mult指令<br>0x0010：multu指令<br>0x0011：div指令<br>0x0100：divu指令<br>0x0101：mfhi指令<br>0x0110：mflo指令<br>0x0111：mthi指令<br>0x1000：mtlo指令</td>
</tr>
<tr class="odd">
<td>A</td>
<td>I</td>
<td>32</td>
<td>运算数据</td>
</tr>
<tr class="even">
<td>B</td>
<td>I</td>
<td>32</td>
<td>运算数据</td>
</tr>
<tr class="odd">
<td>HI</td>
<td>O</td>
<td>32</td>
<td>HI寄存器输出值</td>
</tr>
<tr class="even">
<td>LO</td>
<td>O</td>
<td>32</td>
<td>LO寄存器输出值</td>
</tr>
<tr class="odd">
<td>out</td>
<td>O</td>
<td>32</td>
<td>MDU输出值（HI、LO中选择）</td>
</tr>
<tr class="even">
<td>busy</td>
<td>O</td>
<td>1</td>
<td>乘除运算进行信号</td>
</tr>
</tbody>
</table></li>
</ul>
<h4 id="be字节使能模块">BE（字节使能模块）</h4>
<p>为了实现外置DM的<strong>按字节访存</strong>，我们需要对字中的每一个字节设置<strong>使能信号</strong>（4位）。在本模块中，我们根据当前执行的<strong>访存指令</strong>（由LSOp传递信息）和<strong>DM写入地</strong>址（addr），计算并输出相应的<strong>4位字节使能信号</strong>。同时，为配合<strong>”官方td“</strong>中<strong>”对应字节写入“</strong>的设置，我们还需要在该模块对写入值进行处理。</p>
<ul>
<li><p><strong>端口定义</strong></p>
<table>
<thead>
<tr class="header">
<th>信号名</th>
<th>方向</th>
<th>位宽</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>I</td>
<td>2</td>
<td>DM写入地址的低2位</td>
</tr>
<tr class="even">
<td>LSOp</td>
<td>I</td>
<td>2</td>
<td>访存功能信号</td>
</tr>
<tr class="odd">
<td>WD_in</td>
<td>I</td>
<td>32</td>
<td>未经处理的DM写入数据</td>
</tr>
<tr class="even">
<td>byteen</td>
<td>O</td>
<td>4</td>
<td>字节使能信号</td>
</tr>
<tr class="odd">
<td>WD_out</td>
<td>O</td>
<td>32</td>
<td>处理后的DM写入数据</td>
</tr>
</tbody>
</table></li>
</ul>
<h4 id="de数据扩展模块">DE（数据扩展模块）</h4>
<p>外置DM根据<strong>”读取地址“</strong>的高30位将整个字读出，但是为了能够实现字节和半字的读取，我们在该模块中对读出的整个字进行处理，并对需要写入GRF的字节或半字进行扩展。</p>
<ul>
<li><p><strong>端口定义</strong></p>
<table>
<thead>
<tr class="header">
<th>信号名</th>
<th>方向</th>
<th>位宽</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>I</td>
<td>2</td>
<td>DM写入地址的低2位</td>
</tr>
<tr class="even">
<td>RD_in</td>
<td>I</td>
<td>32</td>
<td>未经处理的DM读出数据</td>
</tr>
<tr class="odd">
<td>LSOp</td>
<td>I</td>
<td>2</td>
<td>访存功能信号</td>
</tr>
<tr class="even">
<td>RD_out</td>
<td>O</td>
<td>32</td>
<td>处理后的DM读出数据</td>
</tr>
</tbody>
</table></li>
</ul>
<h3 id="流水寄存器模块定义">流水寄存器模块定义</h3>
<h4 id="d_regifid流水寄存器">D_Reg（IF/ID流水寄存器）</h4>
<ul>
<li><p><strong>端口定义</strong></p>
<table>
<thead>
<tr class="header">
<th>方向</th>
<th>信号名</th>
<th>位宽</th>
<th>描述</th>
<th>输入来源</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>I</td>
<td>clk</td>
<td>1</td>
<td>时钟信号</td>
<td>mips.v中的clk</td>
</tr>
<tr class="even">
<td>I</td>
<td>reset</td>
<td>1</td>
<td>同步复位信号</td>
<td>mips.v中的reset</td>
</tr>
<tr class="odd">
<td>I</td>
<td>en</td>
<td>1</td>
<td>D级寄存器使能信号</td>
<td>HCU中stall信号取反</td>
</tr>
<tr class="even">
<td>I</td>
<td>clr</td>
<td>1</td>
<td>D级寄存器清空信号</td>
<td>默认为1‘b0</td>
</tr>
<tr class="odd">
<td>I</td>
<td>F_instr</td>
<td>32</td>
<td>F级instr输入</td>
<td>IFU_instr</td>
</tr>
<tr class="even">
<td>I</td>
<td>F_pc</td>
<td>32</td>
<td>F级pc输入</td>
<td>IFU_pc</td>
</tr>
<tr class="odd">
<td>I</td>
<td>F_pc8</td>
<td>32</td>
<td>F级pc8输入</td>
<td>IFU_pc + 8</td>
</tr>
<tr class="even">
<td>O</td>
<td>D_instr</td>
<td>32</td>
<td>D级instr输出</td>
<td></td>
</tr>
<tr class="odd">
<td>O</td>
<td>D_pc</td>
<td>32</td>
<td>D级pc输出</td>
<td></td>
</tr>
<tr class="even">
<td>O</td>
<td>D_pc8</td>
<td>32</td>
<td>D级pc8输出</td>
<td></td>
</tr>
</tbody>
</table></li>
</ul>
<h4 id="e_regidex流水寄存器">E_Reg（ID/EX流水寄存器）</h4>
<ul>
<li><p><strong>端口定义</strong></p>
<table>
<colgroup>
<col style="width: 6%">
<col style="width: 15%">
<col style="width: 6%">
<col style="width: 35%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th>方向</th>
<th>信号名</th>
<th>位宽</th>
<th>描述</th>
<th>输入来源</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>I</td>
<td>clk</td>
<td>1</td>
<td>时钟信号</td>
<td>mips.v中的clk</td>
</tr>
<tr class="even">
<td>I</td>
<td>reset</td>
<td>1</td>
<td>同步复位信号</td>
<td>mips.v中的reset</td>
</tr>
<tr class="odd">
<td>I</td>
<td>clr</td>
<td>1</td>
<td>E级寄存器清空信号</td>
<td>HCU中stall信号</td>
</tr>
<tr class="even">
<td>I</td>
<td>D_instr_s</td>
<td>5</td>
<td>移位指令的位移数</td>
<td>D_instr的s域数据</td>
</tr>
<tr class="odd">
<td>I</td>
<td>D_V1_f</td>
<td>32</td>
<td>D级V1输入（转发值）</td>
<td>通过MUX_CMP_D1选择的数据</td>
</tr>
<tr class="even">
<td>I</td>
<td>D_V2_f</td>
<td>32</td>
<td>D级V2输入（转发值）</td>
<td>通过MUX_CMP_D1选择的数据</td>
</tr>
<tr class="odd">
<td>I</td>
<td>D_A1</td>
<td>5</td>
<td>D级A1输入</td>
<td>D_instr的rs域数据</td>
</tr>
<tr class="even">
<td>I</td>
<td>D_A2</td>
<td>5</td>
<td>D级A2输入</td>
<td>D_instr的rt域数据</td>
</tr>
<tr class="odd">
<td>I</td>
<td>D_A3</td>
<td>5</td>
<td>D级A3输入</td>
<td>通过MUX_A3选择出的数据</td>
</tr>
<tr class="even">
<td>I</td>
<td>D_E32</td>
<td>32</td>
<td>D级E32输入</td>
<td>通过EXT模块扩展出的数据</td>
</tr>
<tr class="odd">
<td>I</td>
<td>D_pc</td>
<td>32</td>
<td>D级pc输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="even">
<td>I</td>
<td>D_pc8</td>
<td>32</td>
<td>D级pc8输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="odd">
<td>I</td>
<td>Tnew_D</td>
<td>2</td>
<td>D级指令的Tnew输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="even">
<td>I</td>
<td>RFWrite_D</td>
<td>1</td>
<td>D级控制信号输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="odd">
<td>I</td>
<td>MemWrite_D</td>
<td>1</td>
<td>D级控制信号输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="even">
<td>I</td>
<td>SelEMOut_D</td>
<td>1</td>
<td>D级控制信号输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="odd">
<td>I</td>
<td>SelWOut_D</td>
<td>1</td>
<td>D级控制信号输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="even">
<td>I</td>
<td>SelALUS_D</td>
<td>1</td>
<td>D级控制信号输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="odd">
<td>I</td>
<td>SelALUB_D</td>
<td>1</td>
<td>D级控制信号输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="even">
<td>I</td>
<td>LSOp_D</td>
<td>3</td>
<td>D级控制信号输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="odd">
<td>I</td>
<td>ALUOp_D</td>
<td>4</td>
<td>D级控制信号输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="even">
<td>I</td>
<td>MUDOp_D</td>
<td>4</td>
<td>D级控制信号输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="odd">
<td>O</td>
<td>E_instr_s</td>
<td>5</td>
<td>移位指令的位移数</td>
<td></td>
</tr>
<tr class="even">
<td>O</td>
<td>E_V1</td>
<td>32</td>
<td>E级V1输出</td>
<td></td>
</tr>
<tr class="odd">
<td>O</td>
<td>E_V2</td>
<td>32</td>
<td>E级V2输出</td>
<td></td>
</tr>
<tr class="even">
<td>O</td>
<td>E_A1</td>
<td>5</td>
<td>E级A1输出</td>
<td></td>
</tr>
<tr class="odd">
<td>O</td>
<td>E_A2</td>
<td>5</td>
<td>E级A2输出</td>
<td></td>
</tr>
<tr class="even">
<td>O</td>
<td>E_A3</td>
<td>5</td>
<td>E级A3输出</td>
<td></td>
</tr>
<tr class="odd">
<td>O</td>
<td>E_E32</td>
<td>32</td>
<td>E级E32输出</td>
<td></td>
</tr>
<tr class="even">
<td>O</td>
<td>E_pc</td>
<td>32</td>
<td>E级pc输出</td>
<td></td>
</tr>
<tr class="odd">
<td>O</td>
<td>E_pc8</td>
<td>32</td>
<td>E级pc输出</td>
<td></td>
</tr>
<tr class="even">
<td>O</td>
<td>Tew_E</td>
<td>2</td>
<td>E级指令的Tnew输出</td>
<td></td>
</tr>
<tr class="odd">
<td>O</td>
<td>RFWrite_E</td>
<td>1</td>
<td>E级控制信号输出</td>
<td></td>
</tr>
<tr class="even">
<td>O</td>
<td>MemWrite_E</td>
<td>1</td>
<td>E级控制信号输出</td>
<td></td>
</tr>
<tr class="odd">
<td>O</td>
<td>SelEMOut_E</td>
<td>1</td>
<td>E级控制信号输出（使用）</td>
<td></td>
</tr>
<tr class="even">
<td>O</td>
<td>SelWOut_E</td>
<td>1</td>
<td>E级控制信号输出</td>
<td></td>
</tr>
<tr class="odd">
<td>O</td>
<td>SelALUS_E</td>
<td>1</td>
<td>E级控制信号输出（使用）</td>
<td></td>
</tr>
<tr class="even">
<td>O</td>
<td>SelALUB_E</td>
<td>1</td>
<td>E级控制信号输出（使用）</td>
<td></td>
</tr>
<tr class="odd">
<td>O</td>
<td>LSOp_E</td>
<td>3</td>
<td>E级控制信号输出（使用）</td>
<td></td>
</tr>
<tr class="even">
<td>O</td>
<td>ALUOp_E</td>
<td>4</td>
<td>E级控制信号输出</td>
<td></td>
</tr>
<tr class="odd">
<td>O</td>
<td>MUDOp_D</td>
<td>4</td>
<td>E级控制信号输出</td>
<td></td>
</tr>
</tbody>
</table></li>
<li><p><strong>运算功能</strong></p>
<p><span class="math inline">\(Tnew\_E = (Tnew\_D &gt; 0) ? Tnew\_D - 1:
0\)</span></p></li>
</ul>
<h4 id="m_regexmem流水寄存器">M_Reg（EX/MEM流水寄存器）</h4>
<ul>
<li><p>端口定义</p>
<table>
<colgroup>
<col style="width: 6%">
<col style="width: 16%">
<col style="width: 6%">
<col style="width: 37%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>方向</th>
<th>信号名</th>
<th>位宽</th>
<th>描述</th>
<th>输入来源</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>I</td>
<td>clk</td>
<td>1</td>
<td>时钟信号</td>
<td>mips.v中的clk</td>
</tr>
<tr class="even">
<td>I</td>
<td>reset</td>
<td>1</td>
<td>同步复位信号</td>
<td>mips.v中的reset</td>
</tr>
<tr class="odd">
<td>I</td>
<td>E_AO</td>
<td>32</td>
<td>E级AO输入</td>
<td>ALU_out数据</td>
</tr>
<tr class="even">
<td>I</td>
<td>E_V2_f</td>
<td>32</td>
<td>E级V2输入（转发值）</td>
<td>MUX_ALU选择出来的数据</td>
</tr>
<tr class="odd">
<td>I</td>
<td>E_A2</td>
<td>32</td>
<td>E级A2输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="even">
<td>I</td>
<td>E_A3</td>
<td>5</td>
<td>E级A3输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="odd">
<td>I</td>
<td>E_pc</td>
<td>32</td>
<td>E级pc输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="even">
<td>I</td>
<td>E_pc8</td>
<td>32</td>
<td>E级pc8输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="odd">
<td>I</td>
<td>Tnew_E</td>
<td>2</td>
<td>E级Tnew输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="even">
<td>I</td>
<td>SelEMOut_E</td>
<td>1</td>
<td>D级控制信号输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="odd">
<td>I</td>
<td>SelWOut_E</td>
<td>1</td>
<td>D级控制信号输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="even">
<td>I</td>
<td>RFWrite_E</td>
<td>1</td>
<td>D级控制信号输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="odd">
<td>I</td>
<td>MemWrite_E</td>
<td>1</td>
<td>D级控制信号输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="even">
<td>I</td>
<td>LSOp_E</td>
<td>3</td>
<td>D级控制信号输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="odd">
<td>O</td>
<td>M_AO</td>
<td>32</td>
<td>M级AO输出</td>
<td></td>
</tr>
<tr class="even">
<td>O</td>
<td>M_V2</td>
<td>32</td>
<td>M级V2输出</td>
<td></td>
</tr>
<tr class="odd">
<td>O</td>
<td>M_A2</td>
<td>32</td>
<td>M级A2输出</td>
<td></td>
</tr>
<tr class="even">
<td>O</td>
<td>M_A3</td>
<td>5</td>
<td>M级A3输出</td>
<td></td>
</tr>
<tr class="odd">
<td>O</td>
<td>M_pc</td>
<td>32</td>
<td>M级pc输出</td>
<td></td>
</tr>
<tr class="even">
<td>O</td>
<td>M_pc8</td>
<td>32</td>
<td>M级pc8输出</td>
<td></td>
</tr>
<tr class="odd">
<td>O</td>
<td>Tnew_M</td>
<td>2</td>
<td>M级Tnew输出</td>
<td></td>
</tr>
<tr class="even">
<td>O</td>
<td>SelEMOut_M</td>
<td>1</td>
<td>D级控制信号输出（使用）</td>
<td></td>
</tr>
<tr class="odd">
<td>O</td>
<td>SelWOut_M</td>
<td>1</td>
<td>D级控制信号输出</td>
<td></td>
</tr>
<tr class="even">
<td>O</td>
<td>RFWrite_M</td>
<td>1</td>
<td>D级控制信号输出</td>
<td></td>
</tr>
<tr class="odd">
<td>O</td>
<td>MemWrite_M</td>
<td>1</td>
<td>D级控制信号输出（使用）</td>
<td></td>
</tr>
<tr class="even">
<td>O</td>
<td>LSOp_M</td>
<td>3</td>
<td>D级控制信号输出（使用）</td>
<td></td>
</tr>
</tbody>
</table></li>
<li><p><strong>运算功能</strong></p>
<p><span class="math inline">\(Tnew\_M = (Tnew\_E &gt; 0) ? Tnew\_E - 1:
0\)</span></p></li>
</ul>
<h4 id="w_regmemwb流水寄存器">W_Reg（MEM/WB流水寄存器）</h4>
<ul>
<li><p><strong>接口定义</strong></p>
<table>
<thead>
<tr class="header">
<th>方向</th>
<th>信号名</th>
<th>位宽</th>
<th>描述</th>
<th>输入来源</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>I</td>
<td>clk</td>
<td>1</td>
<td>时钟信号</td>
<td>mips.v中的clk</td>
</tr>
<tr class="even">
<td>I</td>
<td>reset</td>
<td>1</td>
<td>同步复位信号</td>
<td>mips.v中的reset</td>
</tr>
<tr class="odd">
<td>I</td>
<td>M_AO</td>
<td>32</td>
<td>M级AO输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="even">
<td>I</td>
<td>M_DR</td>
<td>32</td>
<td>M级DR输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="odd">
<td>I</td>
<td>M_A3</td>
<td>5</td>
<td>M级A3输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="even">
<td>I</td>
<td>M_pc</td>
<td>32</td>
<td>M级pc输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="odd">
<td>I</td>
<td>M_pc8</td>
<td>32</td>
<td>M级pc8输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="even">
<td>I</td>
<td>RFWrite_M</td>
<td>1</td>
<td>M级控制信号输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="odd">
<td>I</td>
<td>SelWOut_M</td>
<td>2</td>
<td>M级控制信号输入</td>
<td>前一级相同信号</td>
</tr>
<tr class="even">
<td>O</td>
<td>W_AO</td>
<td>32</td>
<td>W级AO输出</td>
<td></td>
</tr>
<tr class="odd">
<td>O</td>
<td>W_DR</td>
<td>32</td>
<td>W级DR输出</td>
<td></td>
</tr>
<tr class="even">
<td>O</td>
<td>W_A3</td>
<td>5</td>
<td>W级A3输出</td>
<td></td>
</tr>
<tr class="odd">
<td>O</td>
<td>W_pc</td>
<td>32</td>
<td>W级pc输出</td>
<td></td>
</tr>
<tr class="even">
<td>O</td>
<td>W_pc8</td>
<td>32</td>
<td>W级pc8输出</td>
<td></td>
</tr>
<tr class="odd">
<td>O</td>
<td>RFWrite_W</td>
<td>1</td>
<td>W级控制信号输出（使用）</td>
<td></td>
</tr>
<tr class="even">
<td>O</td>
<td>SelWOut_W</td>
<td>2</td>
<td>W级控制信号输出（使用）</td>
<td></td>
</tr>
</tbody>
</table></li>
</ul>
<h3 id="控制模块定义">控制模块定义</h3>
<h4 id="mcu主控制器模块">MCU（主控制器模块）</h4>
<p>在主控制模块中，我们对指令中Opcode域和Funct域中的数据进行解码，输出ALUOp,MemtoReg等19条控制指令，从而对数据通路进行调整，满足不同指令的需求。为实现该模块，我们又在内部设计了两个子模块——和逻辑（AND
Logic）和或逻辑（OR
Logic）。前者的功能是识别，将输入的Opcode和Funct数据识别为对应的指令，后者的功能是生成，根据输入指令的不同产生不同的控制信号。</p>
<ul>
<li><p><strong>输入端口定义</strong></p>
<table>
<thead>
<tr class="header">
<th>信号名</th>
<th>方向</th>
<th>位宽</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>opcode</td>
<td>I</td>
<td>6</td>
<td>输入D_instr_opcode域数据</td>
</tr>
<tr class="even">
<td>funt</td>
<td>I</td>
<td>6</td>
<td>输入D_instr_funct域数据</td>
</tr>
</tbody>
</table></li>
<li><p><strong>输出端口（控制信号）定义</strong></p>
<table>
<colgroup>
<col style="width: 10%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 49%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th>信号名</th>
<th>位宽</th>
<th>作用级</th>
<th>描述</th>
<th>相关指令</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>RFWrite</td>
<td>1</td>
<td>W</td>
<td>GRF写使能信号</td>
<td></td>
</tr>
<tr class="even">
<td>MemWrite</td>
<td>1</td>
<td>M</td>
<td>DM写入使能信号</td>
<td>store型：sw, sb, sh</td>
</tr>
<tr class="odd">
<td>SelA3</td>
<td>2</td>
<td>D</td>
<td>对MUX_A3的输出进行选择</td>
<td></td>
</tr>
<tr class="even">
<td>SelEMOut</td>
<td>1</td>
<td>E、M</td>
<td>对MUX_E_out和MUX_M_out的输出进行选择</td>
<td>jr、jalr</td>
</tr>
<tr class="odd">
<td>SelWOut</td>
<td>2</td>
<td>W</td>
<td>对MUX_W_out的输出进行选择</td>
<td></td>
</tr>
<tr class="even">
<td>SelALUB</td>
<td>1</td>
<td>E</td>
<td>对MUX_ALU_B的输出进行选择</td>
<td></td>
</tr>
<tr class="odd">
<td>SelALUS</td>
<td>1</td>
<td>E</td>
<td>对MUX_ALU_S的输出进行选择</td>
<td>shift型、shiftv型</td>
</tr>
<tr class="even">
<td>NPCOp</td>
<td>3</td>
<td>D</td>
<td>NPC模块功能选择信号</td>
<td></td>
</tr>
<tr class="odd">
<td>CMPOp</td>
<td>3</td>
<td>D</td>
<td>CMP模块功能选择信号</td>
<td>B型</td>
</tr>
<tr class="even">
<td>EXTOp</td>
<td>2</td>
<td>D</td>
<td>EXT模块功能选择信号</td>
<td></td>
</tr>
<tr class="odd">
<td>LSOp</td>
<td>3</td>
<td>M</td>
<td>DM模块功能选择信号</td>
<td>load型、store型</td>
</tr>
<tr class="even">
<td>ALUOp</td>
<td>4</td>
<td>E</td>
<td>ALU模块功能选择信号</td>
<td>calc_R型、calc_I型</td>
</tr>
<tr class="odd">
<td>MDUOp</td>
<td>4</td>
<td>E</td>
<td>MDU模块功能选择信号</td>
<td>md型、mf型、mt型</td>
</tr>
</tbody>
</table></li>
<li><p>注：该模块中的“Sel”型信号均作用于功能MUX</p></li>
</ul>
<h4 id="hcu冒险控制器模块">HCU（冒险控制器模块）</h4>
<p>在冒险控制模块中，我们通过对传入的<strong>“A”</strong>（A1，A2，A3）和<strong>“T”</strong>（Tnew，Tuse）进行分析，判断当前需要进行转发（<strong>forward</strong>）还是暂停（<strong>stall</strong>），并通过组合逻辑生成相应控制信号。</p>
<ul>
<li><p><strong>输入端口定义</strong></p>
<table>
<thead>
<tr class="header">
<th>信号名</th>
<th>方向</th>
<th>位宽</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>D_A1</td>
<td>I</td>
<td>5</td>
<td>D级A1输入</td>
</tr>
<tr class="even">
<td>D_A2</td>
<td>I</td>
<td>5</td>
<td>D级A2输入</td>
</tr>
<tr class="odd">
<td>E_A1</td>
<td>I</td>
<td>5</td>
<td>E级A1输入</td>
</tr>
<tr class="even">
<td>E_A2</td>
<td>I</td>
<td>5</td>
<td>E级A2输入</td>
</tr>
<tr class="odd">
<td>M_A2</td>
<td>I</td>
<td>5</td>
<td>M级A2输入</td>
</tr>
<tr class="even">
<td>E_A3</td>
<td>I</td>
<td>5</td>
<td>E级A3输入</td>
</tr>
<tr class="odd">
<td>M_A3</td>
<td>I</td>
<td>5</td>
<td>M级A3输入</td>
</tr>
<tr class="even">
<td>W_A3</td>
<td>I</td>
<td>5</td>
<td>W级A3输入</td>
</tr>
<tr class="odd">
<td>Tuse_rs</td>
<td>I</td>
<td>2</td>
<td>D级MCU中输出的Tuse_rs信号</td>
</tr>
<tr class="even">
<td>Tuse_rt</td>
<td>I</td>
<td>2</td>
<td>D级MCU中输出的Tuse_rt信号</td>
</tr>
<tr class="odd">
<td>Tnew_E</td>
<td>I</td>
<td>2</td>
<td>E级Tnew_E信号输入</td>
</tr>
<tr class="even">
<td>Tnew_M</td>
<td>I</td>
<td>2</td>
<td>M级Tnew_M信号输入</td>
</tr>
<tr class="odd">
<td>Tnew_W</td>
<td>I</td>
<td>2</td>
<td>W级Tnew_W信号输入</td>
</tr>
</tbody>
</table></li>
<li><p><strong>输出端口（控制信号）定义</strong></p>
<table>
<thead>
<tr class="header">
<th>信号名</th>
<th>位宽</th>
<th>作用级</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>FwdCMPD1</td>
<td>2</td>
<td>D</td>
<td>对HMUX_CMP_D1的输出进行选择</td>
</tr>
<tr class="even">
<td>FwdCMPD2</td>
<td>2</td>
<td>D</td>
<td>对HMUX_CMP_D2的输出进行选择</td>
</tr>
<tr class="odd">
<td>FwdALUA</td>
<td>2</td>
<td>E</td>
<td>对HMUX_ALU_A的输出进行选择</td>
</tr>
<tr class="even">
<td>FwdALUB</td>
<td>2</td>
<td>E</td>
<td>对HMUX_ALU_B的输出进行选择</td>
</tr>
<tr class="odd">
<td>FwdDM</td>
<td>1</td>
<td>M</td>
<td>对HMUX_DM的输出进行选择</td>
</tr>
<tr class="even">
<td>stall</td>
<td>1</td>
<td>F、D、M</td>
<td>暂停信号</td>
</tr>
</tbody>
</table></li>
<li><p>注：该模块中的“Fwd”型信号均作用于转发MUX</p></li>
<li><p>注：该模块中的stall信号同时作用与IFU，D_Reg，E_Reg</p></li>
</ul>
<h3 id="选择器模块">选择器模块</h3>
<h4 id="功能mux">功能MUX</h4>
<table>
<colgroup>
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 63%">
<col style="width: 10%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>MUX名</th>
<th>选择数量</th>
<th>描述</th>
<th>输出信号名</th>
<th>控制信号</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>MUX_A3</td>
<td>3</td>
<td>D级中A3输入信号进行选择<br>0：D_instr_rt<br>1：D_instr_rd<br>2：0x1f</td>
<td>D_A3</td>
<td>SelA3</td>
</tr>
<tr class="even">
<td>MUX_ALU_B</td>
<td>2</td>
<td>对E级ALU模块src_B接口的信号进行选择<br>0：E_V2_f<br>1：E_E32</td>
<td>ALU_B</td>
<td>SelALUB</td>
</tr>
<tr class="odd">
<td>MUX_ALU_S</td>
<td>2</td>
<td>对E级ALU模块src_S接口的信号进行选择<br>0：E_instr_s<br>1：E_V1_f</td>
<td>ALU_S</td>
<td>SelALUS</td>
</tr>
<tr class="even">
<td>MUX_E_out</td>
<td>2</td>
<td>对E级储存的计算结果进行选择<br>0：E_32<br>1：E_pc8</td>
<td>E_out</td>
<td>SelEMOut</td>
</tr>
<tr class="odd">
<td>MUX_M_out</td>
<td>2</td>
<td>对M级储存的计算结果进行选择<br>0：M_AO<br>1：M_pc8</td>
<td>M_out</td>
<td>SelEMOut</td>
</tr>
<tr class="even">
<td>MUX_W_out</td>
<td>3</td>
<td>对W级储存的计算结果进行选择<br>0：W_AO<br>1：W_DR<br>2：W_pc8</td>
<td>W_out</td>
<td>SelWOut</td>
</tr>
</tbody>
</table>
<h4 id="转发mux">转发MUX</h4>
<table>
<colgroup>
<col style="width: 11%">
<col style="width: 8%">
<col style="width: 61%">
<col style="width: 10%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>MUX名</th>
<th>选择数量</th>
<th>描述</th>
<th>输出信号名</th>
<th>控制信号</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>HMUX_CMP_D1</td>
<td>3</td>
<td>将数据转发到CMP_D1接口<br>0：GRF_RD1<br>1：M_out<br>2：E_out</td>
<td>D_V1_f</td>
<td>FwdCMPD1</td>
</tr>
<tr class="even">
<td>HMUX_CMP_D2</td>
<td>3</td>
<td>将数据转发到CMP_D2接口<br>0：GRF_RD2<br>1：M_out<br>2：E_out</td>
<td>D_V2_f</td>
<td>FwdCMPD2</td>
</tr>
<tr class="odd">
<td>HMUX_ALU_A</td>
<td>3</td>
<td>将数据转发到ALU_A接口<br>0：E_V1<br>1：W_out<br>2：M_out</td>
<td>E_V1_f</td>
<td>FwdALUA</td>
</tr>
<tr class="even">
<td>HMUX_ALU_B</td>
<td>3</td>
<td>将数据转发到ALU_B接口<br>0：E_V2<br>1：W_out<br>2：M_out</td>
<td>E_V2_f</td>
<td>FwdALUB</td>
</tr>
<tr class="odd">
<td>HMUX_DM</td>
<td>2</td>
<td>将数据转发到DM_WD接口<br>0：M_V2<br>1：W_out</td>
<td>M_V1_f</td>
<td>FwdDM</td>
</tr>
</tbody>
</table>
<h2 id="重要机制实现方法">重要机制实现方法</h2>
<h3 id="分支转移实现">分支转移实现</h3>
<h4 id="b类指令">B类指令</h4>
<p>为了减少因控制冲突导致的暂停（<strong>stall</strong>），我们将B类指令的判断进行前置，单独使用CMP模块进行判断。当B类指令进入D级后（此时F级的指令为编译优化调度的指令），CMP模块的判断结果进入NPC，如过CMP结果为真（CMP_out
=
1）而且NPCOp信号为0x001（说明当前指令为B类指令），NPC输出转移的地址npc并进入IFU的输入端，在下一时钟沿上升时进入F级，实现转移。</p>
<h4 id="j和jal">j和jal</h4>
<p>当j或jal进入D级后（此时F级的指令为编译优化调度的指令），D_instr中imm26域的数据进入NPC进行处理，如果当前NPCOp信号为0x010（说明当前指令为jal或j指令），NPC输出转移的地址npc，并进入IFU的输入端，在下一时钟沿上升时进入F级，实现转移。</p>
<p>jal指令在实现跳转的同时，还需要将下一条指令的地址存入31号寄存器中，因此我们需要在IFU中计算出改地址，并随着jal指令进行流水，最终在W级写入GRF的31号寄存器。由于存在延迟槽，pc+4地址中的指令是编译优化机制调度过来的，因此我们要保存的地址应该为pc+8。</p>
<h4 id="jr和jalr">jr和jalr</h4>
<p>当jr进入D级后（此时F级的指令为编译优化调度的指令），D_V1_f（经过转发后的D_V1值）进入NPC，如果当前NPCOp信号为0x011（说明当前指令为jr指令），NPC输出转移的地址npc，并进入IFU的输入端，在下一时钟沿上升时进入F级，实现转移。</p>
<p>jalr指令在实现跳转的同时，还需要将下一条指令的地址存入31号寄存器中，因此我们需要在IFU中计算出改地址，并随着jal指令进行流水，最终在W级写入GRF的31号寄存器。由于存在延迟槽，pc+4地址中的指令是编译优化机制调度过来的，因此我们要保存的地址应该为pc+8。</p>
<h3 id="乘除槽实现">乘除槽实现</h3>
<p>为了支持 <strong>mult、multu、div、divu、mfhi、mflo、mthi</strong>
<strong>及</strong> <strong>mtlo</strong>
这些乘除法相关指令，需要设计独立的乘 / 除功能部件。该部件位于在流水线的
EX 阶段，如图 1 所示。</p>
<ul>
<li><p>若当前指令为<strong>mfhi</strong>和<strong>mflo</strong>，即读取<strong>HI</strong>或<strong>LO</strong>中的数据，我们直接根据MDUOp的值将相应数据从out接口输出，进入下一级</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">assign</span> out <span class="token operator">=</span> <span class="token punctuation">(</span>MDUOp <span class="token operator">==</span> <span class="token constant">`MDU_MFHI</span><span class="token punctuation">)</span> <span class="token operator">?</span> HI <span class="token punctuation">:</span> 
             <span class="token punctuation">(</span>MDUOp <span class="token operator">==</span> <span class="token constant">`MDU_MFLO</span><span class="token punctuation">)</span> <span class="token operator">?</span> LO <span class="token punctuation">:</span>
                                    <span class="token number">0</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
<li><p>若当前指令为<strong>mthi</strong>和<strong>mtlo</strong>，即向<strong>HI</strong>或<strong>LO</strong>寄存器中写入数据，可以直接在一个周期内完成，我们直接根据MDUOp的值进行写值操作即可。</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token function">case</span><span class="token punctuation">(</span>MDUOp<span class="token punctuation">)</span>
	<span class="token comment">//…………………………………………………</span>
    <span class="token constant">`MDU_MTHI</span><span class="token punctuation">:</span>   HI <span class="token operator">&lt;=</span> A<span class="token punctuation">;</span>  
    <span class="token constant">`MDU_MTLO</span><span class="token punctuation">:</span>   LO <span class="token operator">&lt;=</span> A<span class="token punctuation">;</span>
<span class="token keyword">endcase</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>若当前指令为<strong>mult、multu、div、divu</strong>，即乘除运算指令，即使我们可以通过Verilog中内置的乘除运算实现，但是我们需要<strong>模拟实际电路的延迟</strong>，因此编程时不能直接将结果写入到<strong>HI</strong>和<strong>LO</strong>寄存器，而是先存入临时寄存器<code>HI_temp</code>和<code>LO_temp</code>。在写入的同时，还需将延迟的周期数记录下来，写入<code>max</code>寄存器。以上操作当乘除指令进入E级时的第一个周期就执行，此时start信号为1。</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"> <span class="token function">case</span><span class="token punctuation">(</span>MDUOp<span class="token punctuation">)</span>
	<span class="token constant">`MDU_MULT</span><span class="token punctuation">:</span> <span class="token keyword">begin</span> 
		<span class="token operator">{</span>HI_temp<span class="token punctuation">,</span> LO_temp<span class="token operator">}</span> <span class="token operator">&lt;=</span> <span class="token kernel-function property">$signed</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token kernel-function property">$signed</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>
		max <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span>
	 <span class="token keyword">end</span>
	<span class="token constant">`MDU_MULTU</span><span class="token punctuation">:</span> <span class="token keyword">begin</span> 
		<span class="token operator">{</span>HI_temp<span class="token punctuation">,</span> LO_temp<span class="token operator">}</span> <span class="token operator">&lt;=</span> <span class="token kernel-function property">$unsigned</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token kernel-function property">$unsigned</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">;</span>
		max <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span>
	 <span class="token keyword">end</span>
	<span class="token constant">`MDU_DIV</span><span class="token punctuation">:</span> <span class="token keyword">begin</span> 
		<span class="token operator">{</span>HI_temp<span class="token punctuation">,</span> LO_temp<span class="token operator">}</span> <span class="token operator">&lt;=</span> <span class="token operator">{</span><span class="token kernel-function property">$signed</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token kernel-function property">$signed</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token kernel-function property">$signed</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token kernel-function property">$signed</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">}</span><span class="token punctuation">;</span>
		max <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	 <span class="token keyword">end</span>
	<span class="token constant">`MDU_DIVU</span><span class="token punctuation">:</span> <span class="token keyword">begin</span> 
		<span class="token operator">{</span>HI_temp<span class="token punctuation">,</span> LO_temp<span class="token operator">}</span> <span class="token operator">&lt;=</span> <span class="token operator">{</span><span class="token kernel-function property">$unsigned</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token kernel-function property">$unsigned</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token kernel-function property">$unsigned</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token kernel-function property">$unsigned</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token operator">}</span><span class="token punctuation">;</span>
		max <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token keyword">end</span>
<span class="token keyword">endcase</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>当模拟延迟结束之后，才能将值写入<strong>HI</strong>和<strong>LO</strong>寄存器。因此我们设置一个计数器<code>cnt</code>，当busy信号有效时进行计数，当达到<code>max</code>时停止计数并清空，同时将<code>HI_temp</code>和<code>LO_temp</code>中的值写入<code>HI</code></p>
<p>和<code>LO</code>。完整代码如下</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token comment">//HI、LO、HI_temp、LO_temp</span>
<span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token keyword">begin</span>
            HI <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            LO <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            HI_temp <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            LO_temp <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
        <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>busy <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">begin</span><span class="token comment">//the first circle </span>
            <span class="token function">case</span><span class="token punctuation">(</span>MDUOp<span class="token punctuation">)</span>
				<span class="token comment">//………………………………</span>
            <span class="token keyword">endcase</span>
        <span class="token keyword">end</span>
        <span class="token keyword">else</span> <span class="token keyword">begin</span><span class="token comment">//busy is 1, meaning the instruction is mult or div</span>
            <span class="token function">if</span><span class="token punctuation">(</span>cnt <span class="token operator">==</span> max <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">{</span>HI<span class="token punctuation">,</span> LO<span class="token operator">}</span> <span class="token operator">&lt;=</span> <span class="token operator">{</span>HI_temp<span class="token punctuation">,</span> LO_temp<span class="token operator">}</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token operator">{</span>HI<span class="token punctuation">,</span> LO<span class="token operator">}</span> <span class="token operator">&lt;=</span> <span class="token operator">{</span>HI<span class="token punctuation">,</span> LO<span class="token operator">}</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
    <span class="token keyword">end</span>
<span class="token comment">// cnt and busy </span>
<span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword">begin</span>
    <span class="token function">if</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        cnt <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> busy <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span> <span class="token keyword">begin</span>
        busy <span class="token operator">&lt;=</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
    <span class="token keyword">else</span> <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">~</span>start <span class="token operator">&amp;&amp;</span> busy<span class="token punctuation">)</span><span class="token keyword">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span>cnt <span class="token operator">==</span> max <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">begin</span>
            cnt <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> busy <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">end</span>
        <span class="token keyword">else</span> cnt <span class="token operator">&lt;=</span> cnt <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span>
<span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>由于乘除运算独立于ALU，因此在乘除槽处于运算延迟时，其他<strong>无关指令</strong>均可继续进行。但是，如果后面的指令<strong>和乘除槽相关</strong>（md、mf、mt三类），则需要<strong>暂停</strong>（stall），延迟模拟结束后才可继续进行。</p></li>
</ul>
<h3 id="冒险处理">冒险处理</h3>
<p>冒险处理我们均通过“A_T”法实现——</p>
<h4 id="转发forward">转发（forward）</h4>
<p>当前面的指令要写寄存器但还未写入，而后面的指令需要用到没有被写入的值时，这时候会产生<strong>数据冒险</strong>，我们首先考虑进行转发。我们<strong>假设所有的数据冒险均可通过转发解决</strong>。也就是说，当某一指令前进到必须使用某一寄存器的值的流水阶段时，这个寄存器的值一定已经产生，并<strong>存储于后续某个流水线寄存器中</strong>。</p>
<p>在这一阶段，我们不管需要的值有没由计算出，都要进行转发，即暴力转发。为实现这一机制，我们要清楚哪些模块需要转发后的数据（<strong>需求者</strong>）和保存着写入值的流水寄存器（<strong>供应者</strong>）</p>
<ul>
<li><p><strong>供应者及其产生的数据</strong></p>
<table>
<thead>
<tr class="header">
<th>流水级</th>
<th>产生数据</th>
<th>MUX名&amp;选择信号名</th>
<th>MUX输出名</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>E</td>
<td>E_E32，E_pc8</td>
<td>MUX_E_out &amp; SelEMOut</td>
<td>E_out</td>
</tr>
<tr class="even">
<td>M</td>
<td>M_AO，M_pc8</td>
<td>MUX_M_out &amp; SelEMOut</td>
<td>M_out</td>
</tr>
<tr class="odd">
<td>W</td>
<td>W_AO，W_RD，W_pc8</td>
<td>MUX_W_out &amp; SelWOut</td>
<td>W_out</td>
</tr>
</tbody>
</table>
<p>注：当M级指令为读hi和lo的指令时，
M_AO中的结果是从上一周期在乘除槽中读取的hi或lo的值；如果是其他指令，M_AO是上一周期ALU的计算结果。</p></li>
<li><p><strong>需求者及其产生的数据</strong></p>
<table>
<colgroup>
<col style="width: 20%">
<col style="width: 29%">
<col style="width: 36%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th>接收端口</th>
<th>选择数据</th>
<th>HMUX名&amp;选择信号名</th>
<th>MUX输出名</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CMP_D1/NPC_ra</td>
<td>D_V1，M_out，E_out</td>
<td>HMUX_CMP_D1 &amp; FwdCMPD1</td>
<td>D_V1_f</td>
</tr>
<tr class="even">
<td>CMP_D2</td>
<td>D_v1，M_out，E_out</td>
<td>HMUX_CMP_D2 &amp; FwdCMPD2</td>
<td>D_V2_f</td>
</tr>
<tr class="odd">
<td>ALU_A/MDU_A</td>
<td>E_V1， W_out，M_out</td>
<td>HMUX_ALU_A &amp; FwdALUA</td>
<td>E_V1_f</td>
</tr>
<tr class="even">
<td>ALU_B/MDU_B</td>
<td>E_V2，W_out，M_out</td>
<td>HMUX_ALU_B &amp; FwdALUB</td>
<td>E_V1_f</td>
</tr>
<tr class="odd">
<td>DM_WD</td>
<td>M_V2， W_out</td>
<td>HMUX_DM &amp; FwdDM</td>
<td>M_V2_f</td>
</tr>
</tbody>
</table></li>
</ul>
<p>从上表可以看出，W级中的数据没有转发到D级，原因是我们在GRF内实现了内部转发机制，将GRF输入端的数据（还未写入）及时反映到RD1或这RD2，判断条件为<code>A3 ==  A2</code>或者<code>A3 == A1</code>。</p>
<p>此时为了生成HMUX的选择信号，我们需要向HCU（冒险控制器）输入”A”数据，然后进行选择信号的计算，执行转发的条件为——</p>
<ul>
<li><strong>前位点的读取寄存器地址和某转发输入来源的写入寄存器地址相等且不为
0</strong></li>
<li><strong>写使能信号有效</strong></li>
</ul>
<p>根据以上条件我们可以生成上面的5个HMUX选择信号，选择信号的输出值应遵循“就近原则”，及最先产生的数据最先被转发。代码如下——</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token keyword">assign</span> FwdCMPD1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>D_A1 <span class="token operator">!=</span> <span class="token number">5'd0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>D_A1 <span class="token operator">==</span> E_A3<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>RFWrite_E<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">2'd2</span> <span class="token punctuation">:</span>
                  <span class="token punctuation">(</span><span class="token punctuation">(</span>D_A1 <span class="token operator">!=</span> <span class="token number">5'd0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>D_A1 <span class="token operator">==</span> M_A3<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>RFWrite_M<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">2'd1</span> <span class="token punctuation">:</span> 
                                                                      <span class="token number">2'd0</span><span class="token punctuation">;</span>
 
<span class="token keyword">assign</span> FwdCMPD2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>D_A2 <span class="token operator">!=</span> <span class="token number">5'd0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>D_A2 <span class="token operator">==</span> E_A3<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>RFWrite_E<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">2'd2</span> <span class="token punctuation">:</span>
                  <span class="token punctuation">(</span><span class="token punctuation">(</span>D_A2 <span class="token operator">!=</span> <span class="token number">5'd0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>D_A2 <span class="token operator">==</span> M_A3<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>RFWrite_M<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">2'd1</span> <span class="token punctuation">:</span>
                                                                      <span class="token number">2'd0</span><span class="token punctuation">;</span>

<span class="token keyword">assign</span> FwdALUA  <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>E_A1 <span class="token operator">!=</span> <span class="token number">5'd0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>E_A1 <span class="token operator">==</span> M_A3<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>RFWrite_M<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">2'd2</span> <span class="token punctuation">:</span>
                  <span class="token punctuation">(</span><span class="token punctuation">(</span>E_A1 <span class="token operator">!=</span> <span class="token number">5'd0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>E_A1 <span class="token operator">==</span> W_A3<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>RFWrite_W<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">2'd1</span> <span class="token punctuation">:</span>
                                                                      <span class="token number">2'd0</span><span class="token punctuation">;</span>

<span class="token keyword">assign</span> FwdALUB  <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>E_A2 <span class="token operator">!=</span> <span class="token number">5'd0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>E_A2 <span class="token operator">==</span> M_A3<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>RFWrite_M<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">2'd2</span> <span class="token punctuation">:</span>
                  <span class="token punctuation">(</span><span class="token punctuation">(</span>E_A2 <span class="token operator">!=</span> <span class="token number">5'd0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>E_A2 <span class="token operator">==</span> W_A3<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>RFWrite_W<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">2'd1</span> <span class="token punctuation">:</span>
                                                                      <span class="token number">2'd0</span><span class="token punctuation">;</span>

<span class="token keyword">assign</span> FwdDM    <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>M_A2 <span class="token operator">!=</span> <span class="token number">5'd0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>M_A2 <span class="token operator">==</span> W_A3<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>RFWrite_W<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1'd1</span> <span class="token punctuation">:</span> 
                                                                      <span class="token number">1'd0</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="暂停stall">暂停（stall）</h4>
<p>接下来，我们来处理通过转发不能处理的数据冒险。在这种情况下，新的数据还未来得及产生。我们只能暂停流水线，等待新的数据产生。为了方便处理，我们仅仅为D级的指令进行暂停处理。</p>
<p>我们把Tuse和Tnew作为暂停的判断依据——</p>
<ul>
<li>Tuse：指令进入 <strong>D
级</strong>后，其后的某个功能部件<strong>再</strong>经过多少时钟周期就<strong>必须</strong>要使用寄存器值。对于有两个操作数的指令，其<strong>每个操作数的
Tuse 值可能不等</strong>（如 store 型指令 rs、rt 的 Tuse 分别为 1 和 2
）。</li>
<li>Tnew：位于 <strong>E
级及其后各级</strong>的指令，再经过多少周期就能够产生要写入寄存器的结果。在我们目前的
CPU 中，W 级的指令Tnew 恒为 0；对于同一条指令，Tnew@M = max(Tnew@E - 1,
0)、</li>
</ul>
<p>在这一阶段，我们找到D级生成的Tuse_rs和Tuse_rt和在E,M,W级寄存器中流水的Tnew_D，Tnew_M，Tnew_W，如下表所示</p>
<ul>
<li><p><strong>Tuse表和计算表达式</strong></p>
<table>
<thead>
<tr class="header">
<th>指令类型</th>
<th>Tuse_rs</th>
<th>Tuse_rt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>calc_R</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>calc_I</td>
<td>1</td>
<td>X</td>
</tr>
<tr class="odd">
<td>shift</td>
<td>X</td>
<td>1</td>
</tr>
<tr class="even">
<td>shiftv</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>load</td>
<td>1</td>
<td>X</td>
</tr>
<tr class="even">
<td>store</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="odd">
<td>md</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>mt</td>
<td>1</td>
<td>X</td>
</tr>
<tr class="odd">
<td>mf</td>
<td>X</td>
<td>X</td>
</tr>
<tr class="even">
<td>branch</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>j / jr</td>
<td>X</td>
<td>X</td>
</tr>
<tr class="even">
<td>jal / jalr</td>
<td>0</td>
<td>X</td>
</tr>
<tr class="odd">
<td>lui</td>
<td>X</td>
<td>X</td>
</tr>
</tbody>
</table>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token comment">//X表示不需要使用GRF中的值，此时Tuse可取得最大值</span>
<span class="token keyword">assign</span> Tuse_rs <span class="token operator">=</span> <span class="token punctuation">(</span>branch <span class="token operator">|</span> _jr <span class="token operator">|</span> _jalr<span class="token punctuation">)</span>                               <span class="token operator">?</span> <span class="token number">2'd0</span> <span class="token punctuation">:</span>
                 <span class="token punctuation">(</span>md <span class="token operator">|</span> mt <span class="token operator">|</span> calc_R <span class="token operator">|</span> calc_I <span class="token operator">|</span> shiftv <span class="token operator">|</span> load <span class="token operator">|</span> store<span class="token punctuation">)</span>  <span class="token operator">?</span> <span class="token number">2'd1</span> <span class="token punctuation">:</span> 
                                                                        <span class="token number">2'd3</span> <span class="token punctuation">;</span>
    
<span class="token keyword">assign</span> Tuse_rt <span class="token operator">=</span> <span class="token punctuation">(</span>branch<span class="token punctuation">)</span>                                   <span class="token operator">?</span> <span class="token number">2'd0</span> <span class="token punctuation">:</span>
                 <span class="token punctuation">(</span>md <span class="token operator">|</span> calc_R <span class="token operator">|</span> shift <span class="token operator">|</span> shiftv<span class="token punctuation">)</span>             <span class="token operator">?</span> <span class="token number">2'd1</span> <span class="token punctuation">:</span>
                 <span class="token punctuation">(</span>store<span class="token punctuation">)</span>                                    <span class="token operator">?</span> <span class="token number">2'd2</span> <span class="token punctuation">:</span> 
                                                              <span class="token number">2'd3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p><strong>Tnew表和计算表达式</strong></p>
<table>
<thead>
<tr class="header">
<th>指令类型</th>
<th>Tnew_D</th>
<th>Tnew_E</th>
<th>Tnew_M</th>
<th>Tnew_W</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>calc_R</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>calc_I</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>shift</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>shiftv</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>load</td>
<td>3</td>
<td>2</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td>store</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr class="odd">
<td>md</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr class="even">
<td>mt</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr class="odd">
<td>mf</td>
<td>2</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>branch</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr class="odd">
<td>jal / jalr</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>j / jr</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr class="odd">
<td>lui</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token comment">//X表示不需要向GRF写值，此时Tnew可取得0(最小值)</span>
<span class="token comment">//在控制器中生成的是D级Tnew，在流水过程中递减</span>
<span class="token keyword">assign</span> Tnew    <span class="token operator">=</span> <span class="token punctuation">(</span>load<span class="token punctuation">)</span>                                     <span class="token operator">?</span> <span class="token number">2'd3</span> <span class="token punctuation">:</span>
                 <span class="token punctuation">(</span>mf <span class="token operator">|</span> calc_R <span class="token operator">|</span> calc_I <span class="token operator">|</span> shift <span class="token operator">|</span> shiftv<span class="token punctuation">)</span>    <span class="token operator">?</span> <span class="token number">2'd2</span> <span class="token punctuation">:</span> 
                 <span class="token punctuation">(</span>_lui<span class="token punctuation">)</span>                                     <span class="token operator">?</span> <span class="token number">2'd1</span> <span class="token punctuation">:</span>
                 <span class="token punctuation">(</span>_jal <span class="token operator">|</span> _jalr<span class="token punctuation">)</span>                             <span class="token operator">?</span> <span class="token number">2'd0</span> <span class="token punctuation">:</span> 
                                                              <span class="token number">2'd0</span><span class="token punctuation">;</span>     <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p>然后我们Tnew和Tuse传入HCU（冒险控制器中），然后进行stall信号的计算。如果满足以下条件则stall有效——</p>
<ul>
<li><p><strong>Tnew &gt; Tuse</strong></p></li>
<li><p><strong>前位点的读取寄存器地址和某转发输入来源的写入寄存器地址相等且不为
0</strong></p></li>
<li><p><strong>写使能信号有效</strong></p></li>
<li><p><strong>当E级延迟槽在进行运算（<code>start | busy</code>）时，D级为md、mt、mf指令</strong></p></li>
</ul>
<p>代码如下——</p>
<ul>
<li><p>```verilog<br>
assign stall_rs_E = (D_A1 != 5'd0) &amp; (D_A1 == E_A3) &amp;
(RFWrite_E) &amp; (Tuse_rs &lt; Tnew_E);</p>
<p>assign stall_rs_M = (D_A1 != 5'd0) &amp; (D_A1 == M_A3) &amp;
(RFWrite_M) &amp; (Tuse_rs &lt; Tnew_M);</p>
<p>assign stall_rt_E = (D_A2 != 5'd0) &amp; (D_A2 == E_A3) &amp;
(RFWrite_E) &amp; (Tuse_rt &lt; Tnew_E);</p>
<p>assign stall_rt_M = (D_A2 != 5'd0) &amp; (D_A2 == M_A3) &amp;
(RFWrite_M) &amp; (Tuse_rt &lt; Tnew_M);</p>
<p>assign stall_rs = stall_rs_E | stall_rs_M;</p>
<p>assign stall_rt = stall_rt_E | stall_rt_M;</p>
<p>assign stall_md = (MDUOp_D != `MDU_NONE) &amp; (E_start |
E_busy);</p>
<p>assign stall = stall_rs | stall_rt | stall_md;<br>
</p><pre class="line-numbers language-none"><code class="language-none">
stall为1时执行以下操作——

- **冻结PC寄存器（IFU_en = ~stall = 0）**
- **冻结D级寄存器（D_en = ~stall = 0）**
- **清空E级寄存器（E_clr = stall = 1）**

## 测试方案

### 典型测试样例

#### 计算、访存指令测试

我们先通过对除了分支、跳转之外的计算访存指令进行测试。该部分测试由python代码自动生成，生成思路是，连续枚举4条连续指令，将calc_R(包含shift_v), calc_I, LS, shift, md, mt, mf七种类型的指令进行排列组合（每一个类型随机取出一条指令），共有2401种排列。为了增加冲突概率，我们将被读写的寄存器范围调整到有限的5个，当测试样例足够多时，基本可以覆盖所有的冲突情况。

- 生成代码

  ```python
  list_R = ["addu", "subu", "and", "or", "nor", "xor", "sltu", "slt", "sllv", "srlv", "srav"]
  list_I = ["andi", "addiu", "ori", "xori", "lui", "slti", "sltiu"]
  list_LS = ["lw", "sw", "lh", "lhu", "sh", "lb", "lbu", "sb"]
  list_shift = ["sll", "srl", "sra"]
  list_B = ["bne", "beq","bgtz", "blez", "bltz", "bgez"]
  list_MD = ["mult", "multu", "div", "divu"]
  list_MT = ["mthi", "mtlo"]
  list_MF = ["mfhi", "mflo"]
  
  length = 8
  
  def R_test(file, n):
     #………………………………
  def I_test(file, n):
     #………………………………
  def LS_test(file, n):
     #………………………………
  def shift_test(file, n):
     #………………………………
  def MD_test(file, n):
     #………………………………
  def MT_test(file, n):
     #………………………………
  def MF_test(file, n):
     #………………………………
      
  instr = [R_test, I_test, LS_test, shift_test, MD_test, MT_test, MF_test]
  
  for i in range(7):
      f = open("mips_code_{}.asm".format(i), "w")
      #寄存器随机赋值
      for x in range(length):
          temp = random.randint(-2147483648, 2147483648) 
          s = "li ${} {}\n".format(x, temp)
          f.write(s)
      f.write("li $8, {}\n\n".format(random.randint(-2147483648, 2147483648) % 10000 + 1))
      #排列生成指令
      for j in range(7):
          for k in range(7):
              for m in range(7):
                  instr[j](f, 1)
                  instr[k](f, 1)
                  instr[m](f, 1)
                  instr[i](f, 1)
                  f.write('\n')
  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p></p></li>
<li><p>测试样例</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog">li <span class="token kernel-function property">$0</span> <span class="token operator">-</span><span class="token number">1590414783</span>
li <span class="token kernel-function property">$1</span> <span class="token operator">-</span><span class="token number">1387657999</span>
li <span class="token kernel-function property">$2</span> <span class="token number">97336612</span>
li <span class="token kernel-function property">$3</span> <span class="token operator">-</span><span class="token number">1971889419</span>
li <span class="token kernel-function property">$4</span> <span class="token number">1148790734</span>
li <span class="token kernel-function property">$5</span> <span class="token operator">-</span><span class="token number">289210629</span>
li <span class="token kernel-function property">$6</span> <span class="token number">1026640559</span>
li <span class="token kernel-function property">$7</span> <span class="token number">1852052372</span>
li <span class="token kernel-function property">$8</span><span class="token punctuation">,</span> <span class="token number">7860</span>

sltu <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$0</span><span class="token punctuation">,</span> <span class="token kernel-function property">$1</span>
srav <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$6</span>
<span class="token keyword">or</span> <span class="token kernel-function property">$6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$0</span><span class="token punctuation">,</span> <span class="token kernel-function property">$4</span>
<span class="token keyword">xor</span> <span class="token kernel-function property">$0</span><span class="token punctuation">,</span> <span class="token kernel-function property">$6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$6</span>

<span class="token keyword">nor</span> <span class="token kernel-function property">$3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$2</span>
slt <span class="token kernel-function property">$0</span><span class="token punctuation">,</span> <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$3</span>
ori <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">31050</span>
<span class="token keyword">or</span> <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$6</span>

subu <span class="token kernel-function property">$1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$6</span>
sltu <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$3</span>
lbu <span class="token kernel-function property">$0</span><span class="token punctuation">,</span> <span class="token function">878</span><span class="token punctuation">(</span><span class="token kernel-function property">$0</span><span class="token punctuation">)</span>
slt <span class="token kernel-function property">$2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$2</span>

<span class="token keyword">or</span> <span class="token kernel-function property">$6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$4</span>
srav <span class="token kernel-function property">$1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$7</span><span class="token punctuation">,</span> <span class="token kernel-function property">$0</span>
sll <span class="token kernel-function property">$0</span><span class="token punctuation">,</span> <span class="token kernel-function property">$7</span><span class="token punctuation">,</span> <span class="token number">7</span>
srlv <span class="token kernel-function property">$6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$6</span>

<span class="token keyword">nor</span> <span class="token kernel-function property">$3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$7</span>
<span class="token keyword">or</span> <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$7</span><span class="token punctuation">,</span> <span class="token kernel-function property">$2</span>
div <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$8</span>
sltu <span class="token kernel-function property">$7</span><span class="token punctuation">,</span> <span class="token kernel-function property">$3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$2</span>

sllv <span class="token kernel-function property">$6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$0</span>
srlv <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$5</span>
mtlo <span class="token kernel-function property">$0</span>
addu <span class="token kernel-function property">$0</span><span class="token punctuation">,</span> <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$4</span>

slt <span class="token kernel-function property">$6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$7</span><span class="token punctuation">,</span> <span class="token kernel-function property">$6</span>
addu <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$1</span>
mfhi <span class="token kernel-function property">$1</span>
<span class="token keyword">nor</span> <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$5</span>

srav <span class="token kernel-function property">$3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$4</span>
sltiu <span class="token kernel-function property">$3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token number">7080</span>
<span class="token keyword">and</span> <span class="token kernel-function property">$3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$0</span><span class="token punctuation">,</span> <span class="token kernel-function property">$4</span>
<span class="token keyword">or</span> <span class="token kernel-function property">$7</span><span class="token punctuation">,</span> <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$5</span>

<span class="token keyword">xor</span> <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$3</span>
andi <span class="token kernel-function property">$2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$6</span><span class="token punctuation">,</span> <span class="token number">25900</span>
xori <span class="token kernel-function property">$1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token number">18289</span>
srlv <span class="token kernel-function property">$0</span><span class="token punctuation">,</span> <span class="token kernel-function property">$6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$5</span>

slt <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$2</span>
ori <span class="token kernel-function property">$7</span><span class="token punctuation">,</span> <span class="token kernel-function property">$3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">32729</span>
lh <span class="token kernel-function property">$7</span><span class="token punctuation">,</span> <span class="token function">1250</span><span class="token punctuation">(</span><span class="token kernel-function property">$0</span><span class="token punctuation">)</span>
sllv <span class="token kernel-function property">$7</span><span class="token punctuation">,</span> <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$4</span>

addu <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$2</span>
xori <span class="token kernel-function property">$7</span><span class="token punctuation">,</span> <span class="token kernel-function property">$0</span><span class="token punctuation">,</span> <span class="token number">11378</span>
srl <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token number">5</span>
addu <span class="token kernel-function property">$6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$6</span>

srav <span class="token kernel-function property">$7</span><span class="token punctuation">,</span> <span class="token kernel-function property">$3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$4</span>
slti <span class="token kernel-function property">$1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">24158</span>
multu <span class="token kernel-function property">$6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$8</span>
sltu <span class="token kernel-function property">$6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$0</span><span class="token punctuation">,</span> <span class="token kernel-function property">$1</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h4 id="转移指令b类和j类功能测试">转移指令（B类和J类）功能测试</h4>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog">main<span class="token punctuation">:</span>	
li	<span class="token kernel-function property">$s0</span><span class="token punctuation">,</span> <span class="token number">0</span>
li	<span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1000</span>
li	<span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> <span class="token number">1000</span>
lui	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token number">0</span>x8000	#s3 is  <span class="token operator">-</span><span class="token number">2147483648</span>
lui	<span class="token kernel-function property">$s4</span><span class="token punctuation">,</span> <span class="token number">0</span>x8000
ori	<span class="token kernel-function property">$s4</span><span class="token punctuation">,</span> <span class="token number">0</span>x0001	#s4 is  <span class="token operator">-</span><span class="token number">2147483647</span>
lui	<span class="token kernel-function property">$s5</span><span class="token punctuation">,</span> <span class="token number">0</span>x7fff
ori	<span class="token kernel-function property">$s5</span><span class="token punctuation">,</span> <span class="token number">0</span>xffff	#s5 is  <span class="token number">2147483647</span>
lui	<span class="token kernel-function property">$s6</span><span class="token punctuation">,</span> <span class="token number">0</span>x7fff
ori	<span class="token kernel-function property">$s6</span><span class="token punctuation">,</span> <span class="token number">0</span>xfffe	#s6 is <span class="token number">2147483646</span>


beq_1<span class="token punctuation">:</span>	beq	<span class="token kernel-function property">$s0</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s0</span><span class="token punctuation">,</span> beq_1_test
		nop
beq_2<span class="token punctuation">:</span>	beq	<span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> beq_2_test
		nop
……
beq_10<span class="token punctuation">:</span>  beq	<span class="token kernel-function property">$s5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s6</span><span class="token punctuation">,</span> beq_10_test
		nop
beq_end<span class="token punctuation">:</span>

bne_1<span class="token punctuation">:</span>	bne	<span class="token kernel-function property">$s0</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> bne_1_test
		nop
……
bne_10<span class="token punctuation">:</span>	bne	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> bne_10_test
		nop
bne_end<span class="token punctuation">:</span>

blez_1<span class="token punctuation">:</span> blez	<span class="token kernel-function property">$s0</span><span class="token punctuation">,</span> blez_1_test
		nop
……
blez_10<span class="token punctuation">:</span> blez	<span class="token kernel-function property">$s6</span><span class="token punctuation">,</span> blez_10_test
		nop
blez_end<span class="token punctuation">:</span>

bgtz_1<span class="token punctuation">:</span>	 bgtz	<span class="token kernel-function property">$s2</span><span class="token punctuation">,</span>bgtz_1_test
		nop
……
bgtz_10<span class="token punctuation">:</span> bgtz	<span class="token kernel-function property">$s1</span><span class="token punctuation">,</span>bgtz_10_test
		nop
bgtz_end<span class="token punctuation">:</span>

jal_1<span class="token punctuation">:</span>	jal	jal_1_test
		nop
……
jal_5<span class="token punctuation">:</span>	jal	jal_5_test
		nop
jal_end<span class="token punctuation">:</span>

sw	<span class="token kernel-function property">$t0</span><span class="token punctuation">,</span> <span class="token function">0</span><span class="token punctuation">(</span><span class="token kernel-function property">$s0</span><span class="token punctuation">)</span>
sw	<span class="token kernel-function property">$t1</span><span class="token punctuation">,</span> <span class="token function">0</span><span class="token punctuation">(</span><span class="token kernel-function property">$s0</span><span class="token punctuation">)</span>
sw	<span class="token kernel-function property">$t2</span><span class="token punctuation">,</span> <span class="token function">0</span><span class="token punctuation">(</span><span class="token kernel-function property">$s0</span><span class="token punctuation">)</span>
sw	<span class="token kernel-function property">$t3</span><span class="token punctuation">,</span> <span class="token function">0</span><span class="token punctuation">(</span><span class="token kernel-function property">$s0</span><span class="token punctuation">)</span>
sw	<span class="token kernel-function property">$t4</span><span class="token punctuation">,</span> <span class="token function">0</span><span class="token punctuation">(</span><span class="token kernel-function property">$s0</span><span class="token punctuation">)</span>
sw	<span class="token kernel-function property">$t5</span><span class="token punctuation">,</span> <span class="token function">0</span><span class="token punctuation">(</span><span class="token kernel-function property">$s0</span><span class="token punctuation">)</span>
li	<span class="token kernel-function property">$v0</span><span class="token punctuation">,</span> <span class="token number">10</span>
syscall
	
beq_1_test<span class="token punctuation">:</span> addi	<span class="token kernel-function property">$t0</span><span class="token punctuation">,</span><span class="token kernel-function property">$t0</span><span class="token punctuation">,</span> <span class="token number">1</span>
	   j	beq_2
		nop
……
beq_10_test<span class="token punctuation">:</span> addi	<span class="token kernel-function property">$t0</span><span class="token punctuation">,</span><span class="token kernel-function property">$t0</span><span class="token punctuation">,</span> <span class="token number">1</span>
	   j	beq_end
		nop

bne_1_test<span class="token punctuation">:</span> addi	<span class="token kernel-function property">$t1</span><span class="token punctuation">,</span><span class="token kernel-function property">$t1</span><span class="token punctuation">,</span> <span class="token number">1</span>
	   j	bne_2
		nop
……
bne_10_test<span class="token punctuation">:</span>addi	<span class="token kernel-function property">$t1</span><span class="token punctuation">,</span><span class="token kernel-function property">$t1</span><span class="token punctuation">,</span> <span class="token number">1</span>
	   j	bne_end
		nop

blez_1_test<span class="token punctuation">:</span>	addi	<span class="token kernel-function property">$t2</span><span class="token punctuation">,</span><span class="token kernel-function property">$t2</span><span class="token punctuation">,</span> <span class="token number">1</span>
		j	blez_2
		nop
……
blez_10_test<span class="token punctuation">:</span>	addi	<span class="token kernel-function property">$t2</span><span class="token punctuation">,</span><span class="token kernel-function property">$t2</span><span class="token punctuation">,</span> <span class="token number">1</span>
		j	blez_end
		nop

bgtz_1_test<span class="token punctuation">:</span>	addi	<span class="token kernel-function property">$t3</span><span class="token punctuation">,</span><span class="token kernel-function property">$t3</span> <span class="token number">1</span>
		j	bgtz_2
		nop
……
bgtz_10_test<span class="token punctuation">:</span>	addi	<span class="token kernel-function property">$t3</span><span class="token punctuation">,</span><span class="token kernel-function property">$t3</span> <span class="token number">1</span>
		j	bgtz_end
		nop
		
jal_1_test<span class="token punctuation">:</span>	addi	<span class="token kernel-function property">$t4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token number">1</span>
		jr	<span class="token kernel-function property">$ra</span>
		nop
……
jal_5_test<span class="token punctuation">:</span>	addi	<span class="token kernel-function property">$t4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token number">1</span>
		jr	<span class="token kernel-function property">$ra</span>
		nop

jalr_1_test<span class="token punctuation">:</span>	addi	<span class="token kernel-function property">$t5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$t5</span><span class="token punctuation">,</span> <span class="token number">1</span>
		jr	<span class="token kernel-function property">$v1</span>
		nop
……
jalr_5_test<span class="token punctuation">:</span>	addi	<span class="token kernel-function property">$t5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$t5</span><span class="token punctuation">,</span> <span class="token number">1</span>
		jr	<span class="token kernel-function property">$v1</span>
		nop<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="转移指令冲突测试">转移指令冲突测试</h4>
<h5 id="连续枚举4条指令最后一条时b类指令在前三条设置和b类相冲突的指令计算访存">连续枚举4条指令，最后一条时b类指令，在前三条设置和B类相冲突的指令（计算、访存）</h5>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog">li	<span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> <span class="token number">6355</span>
li	<span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> <span class="token number">12</span>
li	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">55</span>
li	<span class="token kernel-function property">$s4</span><span class="token punctuation">,</span> <span class="token number">0</span>
li	<span class="token kernel-function property">$s5</span><span class="token punctuation">,</span> <span class="token number">0</span>xffff
li	<span class="token kernel-function property">$s6</span><span class="token punctuation">,</span> <span class="token number">0</span>x7fffffff
li	<span class="token kernel-function property">$s7</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">12333</span>


<span class="token keyword">or</span>	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span>
lw	<span class="token kernel-function property">$s5</span><span class="token punctuation">,</span> <span class="token function">12</span><span class="token punctuation">(</span><span class="token kernel-function property">$0</span><span class="token punctuation">)</span>
add     <span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s2</span>###
beq	<span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> next_1
nop
slt	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s5</span>
next_1<span class="token punctuation">:</span>

<span class="token keyword">or</span>	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span>
sll    <span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s2</span>###
lw	<span class="token kernel-function property">$s5</span><span class="token punctuation">,</span> <span class="token function">12</span><span class="token punctuation">(</span><span class="token kernel-function property">$0</span><span class="token punctuation">)</span>
bne	<span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> next_2
nop
slt	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s5</span>
next_2<span class="token punctuation">:</span>

ori     <span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token number">12345</span>###
<span class="token keyword">or</span>	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span>
lw	<span class="token kernel-function property">$s5</span><span class="token punctuation">,</span> <span class="token function">12</span><span class="token punctuation">(</span><span class="token kernel-function property">$0</span><span class="token punctuation">)</span>
bne	<span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> next_3
nop
slt	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s5</span>
next_3<span class="token punctuation">:</span>


<span class="token keyword">or</span>	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span>
sw	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token function">0</span><span class="token punctuation">(</span><span class="token kernel-function property">$0</span><span class="token punctuation">)</span>
lw      <span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> <span class="token function">0</span><span class="token punctuation">(</span><span class="token kernel-function property">$0</span><span class="token punctuation">)</span>###
bne	<span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> next_4
nop
slt	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s5</span>
next_4<span class="token punctuation">:</span>


sw	<span class="token kernel-function property">$s4</span><span class="token punctuation">,</span> <span class="token function">0</span><span class="token punctuation">(</span><span class="token kernel-function property">$0</span><span class="token punctuation">)</span>
lw      <span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> <span class="token function">0</span><span class="token punctuation">(</span><span class="token kernel-function property">$0</span><span class="token punctuation">)</span>###
<span class="token keyword">or</span>	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span>
bne	<span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> next_5
nop
slt	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s5</span>
next_5<span class="token punctuation">:</span>

sw	<span class="token kernel-function property">$s5</span><span class="token punctuation">,</span> <span class="token function">0</span><span class="token punctuation">(</span><span class="token kernel-function property">$0</span><span class="token punctuation">)</span>
lw      <span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> <span class="token function">0</span><span class="token punctuation">(</span><span class="token kernel-function property">$0</span><span class="token punctuation">)</span>###
<span class="token keyword">and</span>	<span class="token kernel-function property">$s6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$7</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s3</span>
<span class="token keyword">or</span>	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span>
bne	<span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> next_6
nop
slt	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s5</span>
next_6<span class="token punctuation">:</span>


jal	jal_1###
<span class="token keyword">or</span>	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span>
jal_1<span class="token punctuation">:</span>
beq	<span class="token kernel-function property">$31</span><span class="token punctuation">,</span> <span class="token kernel-function property">$31</span><span class="token punctuation">,</span> next_7
nop
slt	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s5</span>
next_7<span class="token punctuation">:</span>


jal	jal_2###
<span class="token keyword">or</span>	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span>
jal_2<span class="token punctuation">:</span>
<span class="token keyword">and</span>	<span class="token kernel-function property">$s6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$7</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s3</span>
beq	<span class="token kernel-function property">$31</span><span class="token punctuation">,</span> <span class="token kernel-function property">$31</span><span class="token punctuation">,</span> next_8
nop
slt	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s5</span>
next_8<span class="token punctuation">:</span>


la	<span class="token kernel-function property">$30</span><span class="token punctuation">,</span> jalr_1
jalr	<span class="token kernel-function property">$30</span>###
<span class="token keyword">or</span>	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span>
jalr_1<span class="token punctuation">:</span>
beq	<span class="token kernel-function property">$31</span><span class="token punctuation">,</span> <span class="token kernel-function property">$31</span><span class="token punctuation">,</span> next_9
nop
slt	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s5</span>
next_9<span class="token punctuation">:</span>

la	<span class="token kernel-function property">$30</span><span class="token punctuation">,</span> jalr_2
jalr	<span class="token kernel-function property">$30</span>###
<span class="token keyword">or</span>	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span>
jalr_2<span class="token punctuation">:</span>
<span class="token keyword">and</span>	<span class="token kernel-function property">$s6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$7</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s3</span>
beq	<span class="token kernel-function property">$31</span><span class="token punctuation">,</span> <span class="token kernel-function property">$31</span><span class="token punctuation">,</span> next_10
nop
slt	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s5</span>
next_10<span class="token punctuation">:</span>

mthi	<span class="token kernel-function property">$s5</span>
mfhi    <span class="token kernel-function property">$s1</span>###
beq	<span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s5</span><span class="token punctuation">,</span> next_11
nop
slt	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s5</span>
next_11<span class="token punctuation">:</span>

mthi	<span class="token kernel-function property">$s5</span>
mfhi    <span class="token kernel-function property">$s1</span>###
add	<span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s7</span>
beq	<span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s5</span><span class="token punctuation">,</span> next_12
nop
slt	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s5</span>
next_12<span class="token punctuation">:</span>

mthi	<span class="token kernel-function property">$s5</span>
mfhi    <span class="token kernel-function property">$s1</span>###
add	<span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s7</span>
lui	<span class="token kernel-function property">$s2</span><span class="token punctuation">,</span> <span class="token number">4455</span>
beq	<span class="token kernel-function property">$s1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s5</span><span class="token punctuation">,</span> next_13
nop
slt	<span class="token kernel-function property">$s3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$s5</span>
next_13<span class="token punctuation">:</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="连续四条指令中存在2个跳转设置模板由代码自动生成">连续四条指令中存在2个跳转（设置模板，由代码自动生成）</h5>
<ul>
<li><p>生成代码</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">B_test</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> lable<span class="token punctuation">)</span><span class="token punctuation">:</span>
    k <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_B<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">or</span> k <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        rs <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> length
        rt <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> length
        s <span class="token operator">=</span> <span class="token string">"{} ${}, ${}, {}\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>list_B<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> rs<span class="token punctuation">,</span> rt<span class="token punctuation">,</span> lable<span class="token punctuation">)</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        rs <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> length
        s <span class="token operator">=</span> <span class="token string">"{} ${}, {}\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>list_B<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> rs<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>lable<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">b_begin</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\nb_test_{}_one:\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    B_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">"b_test_{}_one_then"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    R_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"b_test_{}_two:\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    B_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">"b_test_{}_two_then"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    I_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"jal_test_{}:\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"jal jal_test_{}_then\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    I_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"end_{}:\n\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>

    R_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    I_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    LS_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    shift_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">b_end</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\nb_test_{}_one_then:\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    R_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    I_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    LS_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    shift_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    MD_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    MT_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"j b_test_{}_two\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    R_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\nb_test_{}_two_then:\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    R_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    I_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    LS_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    shift_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    MD_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    MT_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"jal jal_test_{}\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"addu $1, $ra, $0\n"</span><span class="token punctuation">)</span>

    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\njal_test_{}_then:\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    R_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    I_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    LS_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    shift_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    MD_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    MT_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"addiu $ra,$ra, 8\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    B_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">"end_{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    R_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    I_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    LS_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    shift_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    MD_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    MT_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"jr $ra\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>测试样例</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog">b_test_1_one<span class="token punctuation">:</span>
bgtz <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> b_test_1_one_then
addu <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$7</span>
b_test_1_two<span class="token punctuation">:</span>
beq <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$1</span><span class="token punctuation">,</span> b_test_1_two_then
ori <span class="token kernel-function property">$0</span><span class="token punctuation">,</span> <span class="token kernel-function property">$7</span><span class="token punctuation">,</span> <span class="token number">23724</span>
jal_test_1<span class="token punctuation">:</span>
jal jal_test_1_then
ori <span class="token kernel-function property">$3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">28895</span>
end_1<span class="token punctuation">:</span>

sllv <span class="token kernel-function property">$2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$7</span>
andi <span class="token kernel-function property">$0</span><span class="token punctuation">,</span> <span class="token kernel-function property">$2</span><span class="token punctuation">,</span> <span class="token number">6835</span>
sb <span class="token kernel-function property">$2</span><span class="token punctuation">,</span> <span class="token function">2366</span><span class="token punctuation">(</span><span class="token kernel-function property">$0</span><span class="token punctuation">)</span>
sll <span class="token kernel-function property">$2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$1</span><span class="token punctuation">,</span> <span class="token number">2</span>

……………………

b_test_1_one_then<span class="token punctuation">:</span>
addu <span class="token kernel-function property">$1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$0</span><span class="token punctuation">,</span> <span class="token kernel-function property">$7</span>
lui <span class="token kernel-function property">$4</span><span class="token punctuation">,</span><span class="token number">39476</span>
lw <span class="token kernel-function property">$3</span><span class="token punctuation">,</span> <span class="token function">100</span><span class="token punctuation">(</span><span class="token kernel-function property">$0</span><span class="token punctuation">)</span>
srl <span class="token kernel-function property">$1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$0</span><span class="token punctuation">,</span> <span class="token number">0</span>
multu <span class="token kernel-function property">$3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$8</span>
mtlo <span class="token kernel-function property">$7</span>
j b_test_1_two
<span class="token keyword">xor</span> <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$1</span>

b_test_1_two_then<span class="token punctuation">:</span>
srav <span class="token kernel-function property">$6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$2</span>
andi <span class="token kernel-function property">$6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token number">31313</span>
sb <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token function">3770</span><span class="token punctuation">(</span><span class="token kernel-function property">$0</span><span class="token punctuation">)</span>
srl <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$1</span><span class="token punctuation">,</span> <span class="token number">1</span>
divu <span class="token kernel-function property">$2</span><span class="token punctuation">,</span> <span class="token kernel-function property">$8</span>
mtlo <span class="token kernel-function property">$3</span>
jal jal_test_1
addu <span class="token kernel-function property">$1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$ra</span><span class="token punctuation">,</span> <span class="token kernel-function property">$0</span>

jal_test_1_then<span class="token punctuation">:</span>
slt <span class="token kernel-function property">$6</span><span class="token punctuation">,</span> <span class="token kernel-function property">$7</span><span class="token punctuation">,</span> <span class="token kernel-function property">$0</span>
sltiu <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token number">1372</span>
lh <span class="token kernel-function property">$6</span><span class="token punctuation">,</span> <span class="token function">1034</span><span class="token punctuation">(</span><span class="token kernel-function property">$0</span><span class="token punctuation">)</span>
sll <span class="token kernel-function property">$0</span><span class="token punctuation">,</span> <span class="token kernel-function property">$7</span><span class="token punctuation">,</span> <span class="token number">1</span>
multu <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$8</span>
mtlo <span class="token kernel-function property">$6</span>
addiu <span class="token kernel-function property">$ra</span><span class="token punctuation">,</span><span class="token kernel-function property">$ra</span><span class="token punctuation">,</span> <span class="token number">8</span>
bgez <span class="token kernel-function property">$1</span><span class="token punctuation">,</span> end_1
<span class="token keyword">and</span> <span class="token kernel-function property">$5</span><span class="token punctuation">,</span> <span class="token kernel-function property">$3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$2</span>
xori <span class="token kernel-function property">$1</span><span class="token punctuation">,</span> <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">23606</span>
lb <span class="token kernel-function property">$2</span><span class="token punctuation">,</span> <span class="token function">869</span><span class="token punctuation">(</span><span class="token kernel-function property">$0</span><span class="token punctuation">)</span>
sra <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token kernel-function property">$4</span><span class="token punctuation">,</span> <span class="token number">1</span>
multu <span class="token kernel-function property">$3</span><span class="token punctuation">,</span> <span class="token kernel-function property">$8</span>
mtlo <span class="token kernel-function property">$5</span>
jr <span class="token kernel-function property">$ra</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h3 id="自动测试工具">自动测试工具</h3>
<ul>
<li><p><strong>测试代码生成工具（python）</strong></p>
<p>我们先将指令分类，每类指令使用<strong>列表</strong>储存。每一类指令分别用一个单独封装的函数来随机生成，在后面可以跟据需要排列组合</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> random

list_R <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"addu"</span><span class="token punctuation">,</span> <span class="token string">"subu"</span><span class="token punctuation">,</span> <span class="token string">"and"</span><span class="token punctuation">,</span> <span class="token string">"or"</span><span class="token punctuation">,</span> <span class="token string">"nor"</span><span class="token punctuation">,</span> <span class="token string">"xor"</span><span class="token punctuation">,</span> <span class="token string">"sltu"</span><span class="token punctuation">,</span> <span class="token string">"slt"</span><span class="token punctuation">,</span> <span class="token string">"sllv"</span><span class="token punctuation">,</span> <span class="token string">"srlv"</span><span class="token punctuation">,</span> <span class="token string">"srav"</span><span class="token punctuation">]</span>
list_I <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"andi"</span><span class="token punctuation">,</span> <span class="token string">"addiu"</span><span class="token punctuation">,</span> <span class="token string">"ori"</span><span class="token punctuation">,</span> <span class="token string">"xori"</span><span class="token punctuation">,</span> <span class="token string">"lui"</span><span class="token punctuation">,</span> <span class="token string">"slti"</span><span class="token punctuation">,</span> <span class="token string">"sltiu"</span><span class="token punctuation">]</span>
list_LS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"lw"</span><span class="token punctuation">,</span> <span class="token string">"sw"</span><span class="token punctuation">,</span> <span class="token string">"lh"</span><span class="token punctuation">,</span> <span class="token string">"lhu"</span><span class="token punctuation">,</span> <span class="token string">"sh"</span><span class="token punctuation">,</span> <span class="token string">"lb"</span><span class="token punctuation">,</span> <span class="token string">"lbu"</span><span class="token punctuation">,</span> <span class="token string">"sb"</span><span class="token punctuation">]</span>
list_shift <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"sll"</span><span class="token punctuation">,</span> <span class="token string">"srl"</span><span class="token punctuation">,</span> <span class="token string">"sra"</span><span class="token punctuation">]</span>
list_B <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"bne"</span><span class="token punctuation">,</span> <span class="token string">"beq"</span><span class="token punctuation">,</span><span class="token string">"bgtz"</span><span class="token punctuation">,</span> <span class="token string">"blez"</span><span class="token punctuation">,</span> <span class="token string">"bltz"</span><span class="token punctuation">,</span> <span class="token string">"bgez"</span><span class="token punctuation">]</span>
list_MD <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"mult"</span><span class="token punctuation">,</span> <span class="token string">"multu"</span><span class="token punctuation">,</span> <span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token string">"divu"</span><span class="token punctuation">]</span>
list_MTMF <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"mfhi"</span><span class="token punctuation">,</span> <span class="token string">"mflo"</span><span class="token punctuation">,</span> <span class="token string">"mthi"</span><span class="token punctuation">,</span> <span class="token string">"mtlo"</span><span class="token punctuation">]</span>

<span class="token comment">#length是生成的指令所用到的寄存器个数</span>
length <span class="token operator">=</span> <span class="token number">8</span> <span class="token comment">#为了增大冒险概率，我们将寄存器的范围缩小到0~7</span>

<span class="token keyword">def</span> <span class="token function">R_test</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        k <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_R<span class="token punctuation">)</span>
        rs <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> length<span class="token punctuation">;</span>
        rt <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> length<span class="token punctuation">;</span>
        rd <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> length<span class="token punctuation">;</span>
        s <span class="token operator">=</span> <span class="token string">"{} ${}, ${}, ${}\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>list_R<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> rd<span class="token punctuation">,</span> rs<span class="token punctuation">,</span> rt<span class="token punctuation">)</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">I_test</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        k <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_I<span class="token punctuation">)</span>
        rs <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> length
        rt <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> length
        imm <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">32768</span><span class="token punctuation">,</span> <span class="token number">32768</span><span class="token punctuation">)</span>
        abs_imm <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">65536</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> list_I<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"lui"</span><span class="token punctuation">:</span>
            s <span class="token operator">=</span> <span class="token string">"{} ${},{}\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>list_I<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> rt<span class="token punctuation">,</span> abs_imm<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            s <span class="token operator">=</span> <span class="token string">"{} ${}, ${}, {}\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>list_I<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> rt<span class="token punctuation">,</span> rs<span class="token punctuation">,</span> imm<span class="token punctuation">)</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">LS_test</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        k <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_LS<span class="token punctuation">)</span>
        ins <span class="token operator">=</span> list_LS<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
        num <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ins<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            num <span class="token operator">=</span> <span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4096</span>
        <span class="token keyword">elif</span><span class="token punctuation">(</span>ins<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"h"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            num <span class="token operator">=</span> <span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4096</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            num <span class="token operator">=</span> <span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10000000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4096</span>
        
        rt <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> length
        s <span class="token operator">=</span> <span class="token string">"{} ${}, {}($0)\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ins<span class="token punctuation">,</span> rt<span class="token punctuation">,</span> num<span class="token punctuation">)</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">shift_test</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        k <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_shift<span class="token punctuation">)</span>
        shamt <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> length
        rd <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> length
        rt <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> length
        s <span class="token operator">=</span> <span class="token string">"{} ${}, ${}, {}\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>list_shift<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> rd<span class="token punctuation">,</span> rt<span class="token punctuation">,</span> shamt<span class="token punctuation">)</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">MD_test</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        k <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_MD<span class="token punctuation">)</span>
        rs <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> length
        rt <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> length
        <span class="token keyword">if</span><span class="token punctuation">(</span>list_MD<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"mult"</span> <span class="token keyword">or</span> list_MD<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"mul"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            s <span class="token operator">=</span> <span class="token string">"{} ${}, ${}\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>list_MD<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> rs<span class="token punctuation">,</span> rt<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            s <span class="token operator">=</span> <span class="token string">"{} ${}, ${}\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>list_MD<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> rs<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">MTMF_test</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        k <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_MTMF<span class="token punctuation">)</span>
        rs <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> length
        s <span class="token operator">=</span> <span class="token string">"{} ${}\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>list_MTMF<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> rs<span class="token punctuation">)</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">B_test</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> lable<span class="token punctuation">)</span><span class="token punctuation">:</span>
    k <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>list_B<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>k <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">or</span> k <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        rs <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> length
        rt <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> length
        s <span class="token operator">=</span> <span class="token string">"{} ${}, ${}, {}\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>list_B<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> rs<span class="token punctuation">,</span> rt<span class="token punctuation">,</span> lable<span class="token punctuation">)</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        rs <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span> <span class="token operator">%</span> length
        s <span class="token operator">=</span> <span class="token string">"{} ${}, {}\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>list_B<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> rs<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>lable<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">b_begin</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\nb_test_{}_one:\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    B_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">"b_test_{}_one_then"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    R_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"b_test_{}_two:\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    B_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">"b_test_{}_two_then"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    I_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"jal_test_{}:\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"jal jal_test_{}_then\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    I_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"end_{}:\n\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>

    R_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    I_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    LS_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    shift_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">b_end</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\nb_test_{}_one_then:\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    R_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    I_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    LS_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    shift_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    MD_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    MTMF_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"j b_test_{}_two\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    R_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\nb_test_{}_two_then:\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    R_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    I_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    LS_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    shift_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    MD_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    MTMF_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"jal jal_test_{}\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"addu $1, $ra, $0\n"</span><span class="token punctuation">)</span>

    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\njal_test_{}_then:\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    R_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    I_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    LS_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    shift_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    MD_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    MTMF_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"addiu $ra,$ra, 8\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    B_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">"end_{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    R_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    I_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    LS_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    shift_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    MD_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    MTMF_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"jr $ra\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"mips_code.asm"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">:</span>
        temp <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2147483648</span><span class="token punctuation">,</span> <span class="token number">2147483648</span><span class="token punctuation">)</span>
        s <span class="token operator">=</span> <span class="token string">"li ${} {}\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> temp<span class="token punctuation">)</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"li $8, {}\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2147483648</span><span class="token punctuation">,</span> <span class="token number">2147483648</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10000</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment"># index = random.randint(0,10000000) % length</span>
    <span class="token comment"># file.write("li  ${} 0\n".format(index))</span>
    <span class="token comment"># index = random.randint(0,10000000) % length</span>
    <span class="token comment"># file.write("li  ${} 0\n".format(index))</span>
    <span class="token comment"># index = random.randint(0,10000000) % length</span>
    <span class="token comment"># file.write("li  ${} 0\n".format(index))</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        R_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        MD_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
        MTMF_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        I_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        LS_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        MTMF_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        I_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        shift_test<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>

    <span class="token comment"># index = random.randint(0,10000000) % length</span>
    <span class="token comment"># file.write("li  ${} 0\n".format(index))</span>
    <span class="token comment"># index = random.randint(0,10000000) % length</span>
    <span class="token comment"># file.write("li  ${} 0\n".format(index))</span>
    <span class="token comment"># index = random.randint(0,10000000) % length</span>
    <span class="token comment"># file.write("li  ${} 0\n".format(index))</span>

    <span class="token comment"># for i in range(10):</span>
    <span class="token comment">#     b_begin(file, i+1)</span>
    <span class="token comment"># file.write("j   final\n")</span>
    <span class="token comment"># for i in range(10):</span>
    <span class="token comment">#     b_end(file, 1+i)</span>
    <span class="token comment"># file.write("final:\nnop\n")</span>
   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p><strong>自动测试工具（python）</strong></p>
<p>在使用前，我们需要将下方<strong>r_road</strong>和<strong>xilinx_path</strong>中输入工程文件夹路径和ISE路径。在终端运行这个代码（test.py）后，首先需要输入测试次数，对于每一次测试，我们运行一次代码自动生成工具（generate_2.py）,生成MIPS代码（mips_code.asm）,然后会启动mars和ISE分别获得标准输出（mips_out.txt）和测试输出（verilog_out.txt），最后进行文本比较，在终端会显示<strong>比较结果</strong>、<strong>期望执行周期</strong>和<strong>实际执行周期</strong>。如果出现错误，会自动生成错误日志文件，显示错误行数和相应mips机器码、标准输出、测试输出。如果想要对自己写的MIPS代码进行测试，只需要将第132行注释掉，运行次数填写为1即可。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> shutil
<span class="token keyword">import</span> re
run_time <span class="token operator">=</span> <span class="token string">"30us"</span>
xilinx_path <span class="token operator">=</span> <span class="token string">"E:\\Xilinx\\14.7\\ISE_DS\\ISE"</span>
p_path <span class="token operator">=</span> <span class="token string">"D:\\Code\\Verilog\\homework_code\\P6_cpu"</span>
mips_code_name <span class="token operator">=</span> <span class="token string">"mips_code.asm"</span>
mips_out_name <span class="token operator">=</span> <span class="token string">"mips_out.txt"</span>
verilog_out_name <span class="token operator">=</span> <span class="token string">"verilog_out.txt"</span>

error <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
passed <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">run_mars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"编译并运行MIPS文件……"</span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">"java -jar Mars_perfect.jar db mc CompactDataAtZero a dump .text HexText code.txt nc "</span> <span class="token operator">+</span> mips_code_name<span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">"java -jar Mars_perfect.jar db mc CompactDataAtZero nc "</span> <span class="token operator">+</span> mips_code_name <span class="token operator">+</span> <span class="token string">" &gt; "</span> <span class="token operator">+</span> mips_out_name<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">load_hex_code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    list_temp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"code.txt"</span><span class="token punctuation">,</span> <span class="token string">"r+"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> hex_code<span class="token punctuation">:</span>
        list_temp <span class="token operator">=</span> hex_code<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>p_path <span class="token operator">+</span> <span class="token string">"\\code.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> file_to_IM<span class="token punctuation">:</span>
        file_to_IM<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span>list_temp<span class="token punctuation">)</span>
    hex_code<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    file_to_IM<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>



<span class="token keyword">def</span> <span class="token function">run_ise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"编译并运行Verilog文件……"</span><span class="token punctuation">)</span>
    
    file_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token punctuation">,</span>k <span class="token keyword">in</span> os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span>p_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> k<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">file</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">".v"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                file_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>

    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>p_path <span class="token operator">+</span> <span class="token string">"\\mips.prj"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> prj<span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>file_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            prj<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"Verilog work \""</span> <span class="token operator">+</span> p_path <span class="token operator">+</span> <span class="token string">"\\"</span> <span class="token operator">+</span> file_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"\"\n"</span><span class="token punctuation">)</span>           

    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>p_path <span class="token operator">+</span> <span class="token string">"\mips.tcl"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tcl<span class="token punctuation">:</span>
        tcl<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"run "</span> <span class="token operator">+</span> run_time <span class="token operator">+</span><span class="token string">";\nexit"</span><span class="token punctuation">)</span>
    
    prj<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    tcl<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

    os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">"XILINX"</span><span class="token punctuation">]</span> <span class="token operator">=</span> xilinx_path
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>xilinx_path <span class="token operator">+</span> <span class="token string">"\\bin\\nt64\\fuse -nodebug -prj "</span> <span class="token operator">+</span> p_path <span class="token operator">+</span> <span class="token string">"\\mips.prj -o mips.exe mips_tb &gt; compile_log.txt"</span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">"mips.exe -nolog -tclbatch "</span> <span class="token operator">+</span> p_path <span class="token operator">+</span> <span class="token string">"\\mips.tcl&gt; "</span> <span class="token operator">+</span> verilog_out_name<span class="token punctuation">)</span>
    <span class="token comment"># print("mips.exe -nolog -tclbatch " + p_path + "\\mips.tcl &gt; verilog_out.txt")</span>

<span class="token keyword">def</span> <span class="token function">copy_file</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> target_road<span class="token punctuation">)</span><span class="token punctuation">:</span>
    f_1 <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span>
    list_temp <span class="token operator">=</span> f_1<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
    f_2 <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>target_road<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span>
    f_2<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span>list_temp<span class="token punctuation">)</span>
    f_1<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    f_2<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># def file_adj():</span>
<span class="token comment">#     list_temp = list()</span>
<span class="token comment">#     with open(verilog_out_name, "r") as f:</span>
<span class="token comment">#         list_temp = f.readlines()[5:]</span>
<span class="token comment">#         for i in range(len(list_temp) - 1):</span>
<span class="token comment">#             out_1 = re.findall(r"(.+?)@(.+?):", list_temp[i])[0]</span>
<span class="token comment">#             out_2 = re.findall(r"(.+?)@(.+?):", list_temp[i+1])[0]</span>
<span class="token comment">#             if (out_1[0] == out_2[0]) and (int(out_1[1], 16) &gt; int(out_2[1], 16)):</span>
<span class="token comment">#                     str_temp = list_temp[i+1]</span>
<span class="token comment">#                     list_temp[i+1] = list_temp[i]</span>
<span class="token comment">#                     list_temp[i] = str_temp;</span>
<span class="token comment">#     with open(verilog_out_name, "w") as f:</span>
<span class="token comment">#         f.writelines(list_temp)</span>
        
<span class="token keyword">def</span> <span class="token function">file_cmp</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> passed
    time <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>mips_out_name<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> out_1<span class="token punctuation">:</span>
        out_std <span class="token operator">=</span> out_1<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'\n'</span> <span class="token keyword">in</span> out_std<span class="token punctuation">)</span><span class="token punctuation">:</span>
            out_std<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>verilog_out_name<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> out_2<span class="token punctuation">:</span>
        out_test <span class="token operator">=</span> out_2<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
        time <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>out_test<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span>out_test<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">"@"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    flag <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">".\\log.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> log<span class="token punctuation">:</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>out_std<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>out_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            flag <span class="token operator">=</span> <span class="token number">1</span>
            log<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"Too few output! Expected output-lines is {}, But your output-lines is {}\n\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>out_std<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>out_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>out_std<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>out_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            flag <span class="token operator">=</span> <span class="token number">1</span>
            log<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"Too more output! Expected output-lines is {}, But your output-lines is {}\n\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>out_std<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>out_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>out_std<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>out_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>out_std<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> out_test<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>out_test<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">"@"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"(.+?)@"</span><span class="token punctuation">,</span> out_test<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"(.+?)@"</span><span class="token punctuation">,</span> out_test<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                    log<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"Error in line {}: \nExpected output is \"{}\", but your outout is \"{}\"\n\n"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> out_std<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> out_test<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>out_test<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">"@"</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    str_temp <span class="token operator">=</span> out_test<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span>
                    out_test<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> out_test<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                    out_test<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> str_temp<span class="token punctuation">;</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>verilog_out_name<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span>out_test<span class="token punctuation">)</span>
        
    <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"测试结果:  Failed!"</span><span class="token punctuation">)</span>
        error<span class="token punctuation">.</span>append<span class="token punctuation">(</span>order<span class="token punctuation">)</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span><span class="token string">".\\test_log_file\\log_{}\\"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">)</span>
        copy_file<span class="token punctuation">(</span><span class="token string">"log.txt"</span><span class="token punctuation">,</span> <span class="token string">".\\test_log_file\\log_{}\\log.txt"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">)</span>
        copy_file<span class="token punctuation">(</span>mips_code_name<span class="token punctuation">,</span> <span class="token string">".\\test_log_file\\log_{}\\mips_code.asm"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">)</span>
        copy_file<span class="token punctuation">(</span>mips_out_name<span class="token punctuation">,</span> <span class="token string">".\\test_log_file\\log_{}\\mips_out.txt"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">)</span>
        copy_file<span class="token punctuation">(</span>verilog_out_name<span class="token punctuation">,</span> <span class="token string">".\\test_log_file\\log_{}\\verilog_out.txt"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"测试结果:  Accepted!"</span><span class="token punctuation">)</span>
        passed <span class="token operator">=</span> passed <span class="token operator">+</span> <span class="token number">1</span>

    s <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'java -jar Hazard-Calculator.jar code.txt --hz  --im-base 0x3000 --im-size 16384 --dm-base 0 --dm-size 12288 '</span></span>
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"   your circle: {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>time <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

test_times <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入测试次数："</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"测试开始！\n"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">".\\test_log_file"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    shutil<span class="token punctuation">.</span>rmtree<span class="token punctuation">(</span><span class="token string">".\\test_log_file"</span><span class="token punctuation">)</span> 
os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span><span class="token string">".\\test_log_file\\"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"错误日志文件夹已创建！"</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>test_times <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n测试进度:  {}/{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> test_times<span class="token punctuation">)</span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">"python generate.py"</span><span class="token punctuation">)</span>

    run_mars<span class="token punctuation">(</span><span class="token punctuation">)</span>
    load_hex_code<span class="token punctuation">(</span><span class="token punctuation">)</span>
    run_ise<span class="token punctuation">(</span><span class="token punctuation">)</span>
    file_cmp<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n通过率：{}/{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>passed<span class="token punctuation">,</span>test_times<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"错误样例:"</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h2 id="思考题">思考题</h2>
<ul>
<li><p><strong>Q：为什么需要有单独的乘除法部件而不是整合进
ALU？为何需要有独立的 HI、LO 寄存器？</strong></p>
<p><strong>A：</strong>如果乘除法部件在ALU中，那么在乘除运算延迟的过程中，其他指令因为无法使用ALU而无法继续执行。而单独的乘除法部件可以保证在运算延迟的过程中，其他<strong>无关指令</strong>仍然可以正常访问ALU并执行，提高执行速度。<em>hi</em>和<em>lo</em>是与乘法运算器相关的两个寄存器，的用来存放结果的地方。它们并不是
通用寄存器,除了用在乘除法之外,也不能有做其他用途。由高内聚、低耦合的原则，我们必须将他们独立。</p></li>
<li><p><strong>Q：参照你对延迟槽的理解，试解释 “乘除槽”。</strong></p>
<p><strong>A：</strong>乘除槽是专门进行乘除运算的结构，与其他模块独立。乘除槽的设置使得乘除运算独立出来，在单独的模块中进行运算，在运算延迟中不会对其他<strong>无关指令</strong>的执行产生任何影响。</p></li>
<li><p><strong>Q：举例说明并分析何时按字节访问内存相对于按字访问内存性能上更有优势。（Hint：
考虑 C 语言中字符串的情况）</strong></p>
<p><strong>A：</strong>当我们只需要对<strong>字节</strong>或<strong>半字</strong>访问时，<strong>按字节访问内存</strong>性能更由优势。如果此时还采用<strong>按字访问</strong>，则需要首先将整个字从内存中拿出来，然后再从字中寻找，效率会更低。</p></li>
<li><p><strong>Q：在本实验中你遇到了哪些不同指令类型组合产生的冲突？你又是如何解决的？相应的测试样例是什么样的？</strong></p>
<p>如果你是手动构造的样例，请说明构造策略，说明你的测试程序如何保证<strong>覆盖</strong>了所有需要测试的情况；如果你是<strong>完全随机</strong>生成的测试样例，请思考完全随机的测试程序有何不足之处；如果你在生成测试样例时采用了<strong>特殊的策略</strong>，比如构造连续数据冒险序列，请你描述一下你使用的策略如何<strong>结合了随机性</strong>达到强测的效果。</p>
<p><strong>A：</strong>我是采用半随机生成半手动构造的方法。对于功能型指令，完全通过python脚本自动生成。并且为了提高数据冲突的概率，我们仅仅使用0~7号寄存器进行测试。对于跳转指令，我们先使用一定模板进行构建，然后为了增加数据冒险和控制冒险，我们又手动进行一定修改，使得测试样例尽可能更多的覆盖所有可能的情况</p></li>
<li><p><strong>Q：为了对抗复杂性你采取了哪些抽象和规范手段？这些手段在译码和处理数据冲突的时候有什么样的特点与帮助？</strong></p>
<p><strong>A：</strong>我们根据不同指令之间的相似性将指令分成了几类——calc_R、calc_I、shift、shiftv、load、store、B类、J类、md类、mf类、mt类，
并设置对应信号帮助译码，防止计算表达式过长，而且在处理数据冲突时我们只需要将表示该类的信号写入表达式即可。此外，我们将相似功能的控制信号用一个多位宽信号来表示，如针对DM的访存功能，我们设置一个3位LSOp信号；针对乘除槽中的md、mf、mt功能，我们设置一个MDUOp信号来控制，从而减少了流水寄存器的接口数目，从而降低复杂度。</p></li>
</ul>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Hyggge</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://hyggge.github.io/2021/11/26/co/co-p6-liu-shui-xian-cpu-plus/">http://hyggge.github.io/2021/11/26/co/co-p6-liu-shui-xian-cpu-plus/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Hyggge</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/BUAA/">
                                    <span class="chip bg-color">BUAA</span>
                                </a>
                            
                                <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90/">
                                    <span class="chip bg-color">计算机组成</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2021/12/06/co/co-p5-p6-ke-shang-ce-shi-zong-jie/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/15.jpg" class="responsive-img" alt="「BUAA-CO」P5&amp;P6_课上测试总结">
                        
                        <span class="card-title">「BUAA-CO」P5&amp;P6_课上测试总结</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-12-06
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90/" class="post-category">
                                    计算机组成
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/BUAA/">
                        <span class="chip bg-color">BUAA</span>
                    </a>
                    
                    <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90/">
                        <span class="chip bg-color">计算机组成</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/11/15/co/co-p5-liu-shui-xian-cpu-basic/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/8.jpg" class="responsive-img" alt="「BUAA-CO」P5_流水线cpu（Basic）">
                        
                        <span class="card-title">「BUAA-CO」P5_流水线cpu（Basic）</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-11-15
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90/" class="post-category">
                                    计算机组成
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/BUAA/">
                        <span class="chip bg-color">BUAA</span>
                    </a>
                    
                    <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90/">
                        <span class="chip bg-color">计算机组成</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>


  <!-- 是否加载使用自带的 prismjs. -->
  <script type="text/javascript" src="/libs/prism/prism.min.js"></script>


<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('1'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\\(', '\\)']]}
    });
</script>



    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2023</span>
            
            <a href="/about" target="_blank">Hyggge</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
                <span id="translate">|&nbsp;繁/简：</span><a id="translateLink" href="javascript:translatePage();">繁</a>
            
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">173.1k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/hyggge" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:hyggge6@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1695386157" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1695386157" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
        <script type="text/javascript" src="/js/tw_cn.js"></script>
        <script type="text/javascript">
          var defaultEncoding = 2; //网站编写字体是否繁体，1-繁体，2-简体
          var translateDelay = 0; //延迟时间,若不在前, 要设定延迟翻译时间, 如100表示100ms,默认为0
          var cookieDomain = "http://hyggge.github.io"; //Cookie地址, 一定要设定, 通常为你的网址
          var msgToTraditionalChinese = "繁"; //此处可以更改为你想要显示的文字
          var msgToSimplifiedChinese = "简"; //同上，但两处均不建议更改
          var translateButtonId = "translateLink"; //默认互换id
          translateInitilization();
        </script>
    
    
    

    <!-- 雪花特效 -->
     
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/snow.js"><\/script>');
            }
        </script>
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
